<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameStore - C·ª≠a h√†ng game online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            box-sizing: border-box;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        .gradient-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.15"/><circle cx="20" cy="80" r="0.5" fill="white" opacity="0.15"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events: none;
        }

        .dark-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .game-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .game-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .game-card:hover::before {
            opacity: 1;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            animation: modalFadeIn 0.3s ease-out;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            color: #ffffff;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes modalSlideIn {
            from { 
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 1001;
            padding: 16px 24px;
            border-radius: 16px;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 380px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.9), rgba(5, 150, 105, 0.9));
        }

        .notification.error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9));
        }

        .notification::before {
            content: '';
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .notification.success::before {
            content: '‚úì';
            background: rgba(255,255,255,0.2);
        }

        .notification.error::before {
            content: '!';
            background: rgba(255,255,255,0.2);
        }

        /* Enhanced Responsive Design */
        @media (max-width: 1024px) {
            .max-w-7xl {
                max-width: 100%;
                padding: 0 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .gradient-bg h1 {
                font-size: 2rem !important;
                line-height: 1.2;
            }
            
            .grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .lg\:grid-cols-4 {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
            
            .lg\:col-span-2 {
                grid-column: span 1;
            }
            
            .lg\:col-span-3 {
                grid-column: span 1;
            }

            .notification {
                top: 16px;
                right: 16px;
                left: 16px;
                max-width: none;
                transform: translateY(-100px);
                font-size: 14px;
                padding: 12px 16px;
            }

            .notification.show {
                transform: translateY(0);
            }

            .modal-content {
                margin: 1rem;
                max-height: 90vh;
                overflow-y: auto;
                border-radius: 20px;
            }

            .game-card:hover {
                transform: translateY(-4px) scale(1.01);
            }
        }

        @media (max-width: 480px) {
            .gradient-bg h1 {
                font-size: 1.75rem !important;
            }

            .lg\:grid-cols-4 {
                grid-template-columns: 1fr;
            }

            .game-card {
                border-radius: 16px;
            }

            .modal-content {
                border-radius: 16px;
                margin: 0.5rem;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .max-h-96::-webkit-scrollbar {
            width: 6px;
        }

        .max-h-96::-webkit-scrollbar-track {
            background: #2a2a2a;
            border-radius: 3px;
        }

        .max-h-96::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 3px;
        }

        .max-h-96::-webkit-scrollbar-thumb:hover {
            background: #666;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3), 0 4px 12px rgba(0, 0, 0, 0.2);
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(102, 126, 234, 0.6);
            backdrop-filter: blur(10px);
        }

        input, select, textarea {
            background-color: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #ffffff;
            transition: all 0.3s ease;
        }

        input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .dark-card:hover {
            box-shadow: 0 10px 25px rgba(255,255,255,0.1);
        }

        .profile-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid #333;
        }

        .transaction-item {
            transition: all 0.2s ease;
            background: #1a1a1a;
            border: 1px solid #333;
        }

        .transaction-item:hover {
            background-color: #2a2a2a;
            transform: translateX(4px);
            border-color: #555;
        }

        .amount-btn {
            transition: all 0.2s ease;
            border: 2px solid #333;
            background-color: #1a1a1a;
            color: #ffffff;
        }

        .amount-btn:hover {
            border-color: #3b82f6;
            background-color: #2a2a2a;
        }

        .amount-btn.selected {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .bank-info {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            border: 1px solid #3b82f6;
        }

        .copy-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #ffffff;
        }

        .copy-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .text-gray-800 {
            color: #ffffff !important;
        }

        .text-gray-600 {
            color: #cccccc !important;
        }

        .text-gray-500 {
            color: #999999 !important;
        }

        .bg-gray-50 {
            background-color: #0f0f0f !important;
        }

        .bg-white {
            background-color: #1a1a1a !important;
            border: 1px solid #333;
        }

        .border-gray-300 {
            border-color: #333 !important;
        }

        .border-gray-200 {
            border-color: #333 !important;
        }

        .transaction-tab {
            transition: all 0.2s ease;
        }

        .transaction-tab.active {
            border-color: #3b82f6 !important;
            color: #3b82f6 !important;
        }

        /* Telegram floating button */
        .telegram-float {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #0088cc, #229ED9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(0, 136, 204, 0.4);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: telegramPulse 2s infinite;
        }

        .telegram-float:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 136, 204, 0.6);
        }

        .telegram-float i {
            color: white;
            font-size: 24px;
            animation: telegramBounce 1.5s ease-in-out infinite;
        }

        @keyframes telegramPulse {
            0% {
                box-shadow: 0 4px 20px rgba(0, 136, 204, 0.4);
            }
            50% {
                box-shadow: 0 4px 20px rgba(0, 136, 204, 0.7), 0 0 0 10px rgba(0, 136, 204, 0.1);
            }
            100% {
                box-shadow: 0 4px 20px rgba(0, 136, 204, 0.4);
            }
        }

        @keyframes telegramBounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-3px);
            }
        }

        .telegram-tooltip {
            position: absolute;
            right: 70px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .telegram-tooltip::after {
            content: '';
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            border: 6px solid transparent;
            border-left-color: rgba(0, 0, 0, 0.8);
        }

        .telegram-float:hover .telegram-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .mobile-menu-open {
            transform: translateX(0) !important;
        }
        
        /* Mobile menu overlay */
        .mobile-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 49;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease-in-out;
        }
        
        .mobile-menu-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* Snow Effect */
        .snowflake {
            position: fixed;
            top: -10px;
            z-index: 9999;
            user-select: none;
            cursor: default;
            animation-name: snowfall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1em;
            pointer-events: none;
        }

        @keyframes snowfall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .snowflake:nth-child(odd) {
            animation-duration: 12s;
        }

        .snowflake:nth-child(even) {
            animation-duration: 15s;
        }

        .snowflake:nth-child(3n) {
            animation-duration: 18s;
            font-size: 0.8em;
        }

        .snowflake:nth-child(4n) {
            animation-duration: 20s;
            font-size: 1.2em;
        }

        .snowflake:nth-child(5n) {
            animation-duration: 14s;
            font-size: 0.6em;
        }

        .snowflake:nth-child(6n) {
            animation-duration: 16s;
            font-size: 0.9em;
        }

        /* Different snow symbols for variety */
        .snowflake.type-1::before { content: '‚ùÑ'; }
        .snowflake.type-2::before { content: '‚ùÖ'; }
        .snowflake.type-3::before { content: '‚ùÜ'; }
        .snowflake.type-4::before { content: '‚úª'; }
        .snowflake.type-5::before { content: '‚úº'; }
        .snowflake.type-6::before { content: '‚ùã'; }

        @media (max-width: 768px) {
            .telegram-float {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
            }
            
            .telegram-float i {
                font-size: 20px;
            }
            
            .telegram-tooltip {
                display: none;
            }

            #mobileMenu {
                width: 85vw;
                max-width: 320px;
            }
        }
        
        @media (max-width: 480px) {
            #mobileMenu {
                width: 90vw;
                max-width: 280px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Mobile Menu Overlay -->
    <div id="mobileMenuOverlay" class="mobile-menu-overlay" onclick="closeMobileMenu()"></div>

    <!-- Navigation -->
    <nav class="gradient-bg text-white shadow-2xl relative z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4 backdrop-filter backdrop-blur-sm">
                        <i class="fas fa-gamepad text-2xl"></i>
                    </div>
                    <div>
                        <span class="text-2xl font-bold bg-gradient-to-r from-white to-blue-200 bg-clip-text text-transparent">GameStore</span>
                        <div class="text-xs opacity-75">Dopi Team</div>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#" onclick="showSection('home')" class="nav-link relative px-3 py-2 rounded-lg transition-all duration-300 hover:bg-white hover:bg-opacity-10">
                        <i class="fas fa-home mr-2"></i>Trang ch·ªß
                    </a>
                    <a href="#" onclick="showSection('games')" class="nav-link relative px-3 py-2 rounded-lg transition-all duration-300 hover:bg-white hover:bg-opacity-10">
                        <i class="fas fa-gamepad mr-2"></i>Game
                    </a>
                    <a href="#" onclick="showSection('minigames')" class="nav-link relative px-3 py-2 rounded-lg transition-all duration-300 hover:bg-white hover:bg-opacity-10">
                        <i class="fas fa-dice mr-2"></i>Mini Game
                    </a>

                    <div id="userNav" class="hidden items-center space-x-4">
                        <div class="bg-white bg-opacity-15 backdrop-filter backdrop-blur-sm px-4 py-2 rounded-full border border-white border-opacity-20">
                            <i class="fas fa-wallet mr-2 text-green-300"></i>
                            <span id="userBalance" class="font-semibold">0 VNƒê</span>
                        </div>
                        <button onclick="showSection('profile')" class="nav-link relative px-3 py-2 rounded-lg transition-all duration-300 hover:bg-white hover:bg-opacity-10">
                            <i class="fas fa-user mr-2"></i>H·ªì s∆°
                        </button>
                        <button onclick="showCart()" class="nav-link relative px-3 py-2 rounded-lg transition-all duration-300 hover:bg-white hover:bg-opacity-10">
                            <i class="fas fa-shopping-cart mr-1"></i>
                            <span id="cartCount" class="absolute -top-1 -right-1 bg-gradient-to-r from-red-500 to-pink-500 text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold shadow-lg">0</span>
                        </button>
                        <button onclick="logout()" class="nav-link relative px-3 py-2 rounded-lg transition-all duration-300 hover:bg-red-500 hover:bg-opacity-20 text-red-200">
                            <i class="fas fa-sign-out-alt mr-2"></i>ƒêƒÉng xu·∫•t
                        </button>
                    </div>
                    <div id="guestNav" class="flex items-center space-x-4">
                        <button onclick="showLogin()" class="nav-link relative px-4 py-2 rounded-lg transition-all duration-300 hover:bg-white hover:bg-opacity-10">
                            <i class="fas fa-sign-in-alt mr-2"></i>ƒêƒÉng nh·∫≠p
                        </button>
                        <button onclick="showRegister()" class="btn-primary px-6 py-2 rounded-xl shadow-lg">
                            <i class="fas fa-user-plus mr-2"></i>ƒêƒÉng k√Ω
                        </button>
                    </div>
                </div>
                <button id="mobileMenuBtn" class="md:hidden p-2 rounded-lg bg-white bg-opacity-10 backdrop-filter backdrop-blur-sm">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="md:hidden fixed top-0 left-0 bottom-0 w-80 bg-black bg-opacity-95 backdrop-filter backdrop-blur-lg border-r border-white border-opacity-20 transform -translate-x-full transition-all duration-300 ease-in-out z-50 overflow-y-auto">
            <!-- Menu Header -->
            <div class="flex items-center justify-between p-4 border-b border-white border-opacity-20">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-3">
                        <i class="fas fa-gamepad text-lg"></i>
                    </div>
                    <div>
                        <span class="text-lg font-bold">GameStore</span>
                        <div class="text-xs opacity-75">Dopi Team</div>
                    </div>
                </div>
                <button onclick="closeMobileMenu()" class="p-2 rounded-lg bg-white bg-opacity-10 hover:bg-opacity-20 transition-colors">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            
            <div class="px-4 py-6 space-y-4">
                <a href="#" onclick="showSection('home'); closeMobileMenu()" class="block px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors">
                    <i class="fas fa-home mr-3"></i>Trang ch·ªß
                </a>
                <a href="#" onclick="showSection('games'); closeMobileMenu()" class="block px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors">
                    <i class="fas fa-gamepad mr-3"></i>Game
                </a>
                <a href="#" onclick="showSection('minigames'); closeMobileMenu()" class="block px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors">
                    <i class="fas fa-dice mr-3"></i>Mini Game
                </a>

                
                <div id="mobileUserNav" class="hidden space-y-4 border-t border-white border-opacity-20 pt-4">
                    <div class="px-4 py-3 bg-gradient-to-r from-green-600 to-blue-600 bg-opacity-20 rounded-lg border border-green-400 border-opacity-30">
                        <div class="flex items-center">
                            <i class="fas fa-wallet mr-2 text-green-300"></i>
                            <div>
                                <p class="text-xs text-green-200">S·ªë d∆∞ hi·ªán t·∫°i</p>
                                <span id="mobileUserBalance" class="font-semibold text-white">0 VNƒê</span>
                            </div>
                        </div>
                    </div>
                    <a href="#" onclick="showSection('profile'); closeMobileMenu()" class="block px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors">
                        <i class="fas fa-user mr-3"></i>H·ªì s∆°
                    </a>
                    <a href="#" onclick="showCart(); closeMobileMenu()" class="block px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors relative">
                        <i class="fas fa-shopping-cart mr-3"></i>Gi·ªè h√†ng
                        <span id="mobileCartCount" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-red-500 text-xs rounded-full w-6 h-6 flex items-center justify-center">0</span>
                    </a>
                    <button onclick="logout(); closeMobileMenu()" class="w-full text-left px-4 py-3 rounded-lg hover:bg-red-500 hover:bg-opacity-20 transition-colors text-red-200">
                        <i class="fas fa-sign-out-alt mr-3"></i>ƒêƒÉng xu·∫•t
                    </button>
                </div>
                
                <div id="mobileGuestNav" class="space-y-4 border-t border-white border-opacity-20 pt-4">
                    <button onclick="showLogin(); closeMobileMenu()" class="w-full text-left px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors">
                        <i class="fas fa-sign-in-alt mr-3"></i>ƒêƒÉng nh·∫≠p
                    </button>
                    <button onclick="showRegister(); closeMobileMenu()" class="w-full btn-primary px-4 py-3 rounded-lg">
                        <i class="fas fa-user-plus mr-3"></i>ƒêƒÉng k√Ω
                    </button>
                </div>
                
                <!-- Contact Section -->
                <div class="border-t border-white border-opacity-20 pt-4">
                    <a href="https://t.me/tomxinh917" target="_blank" rel="noopener noreferrer" class="block px-4 py-3 rounded-lg bg-blue-600 bg-opacity-20 border border-blue-400 border-opacity-30 hover:bg-opacity-30 transition-colors">
                        <div class="flex items-center">
                            <i class="fab fa-telegram-plane mr-3 text-blue-300"></i>
                            <div>
                                <p class="font-medium">Li√™n h·ªá h·ªó tr·ª£</p>
                                <p class="text-xs opacity-75">Telegram 24/7</p>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="min-h-screen">
        <!-- Home Section -->
        <section id="homeSection" class="section">
            <!-- Hero Banner -->
            <div class="gradient-bg text-white py-20">
                <div class="max-w-7xl mx-auto px-4 text-center">
                    <h1 class="text-5xl font-bold mb-6">üéÆ Ch√†o m·ª´ng ƒë·∫øn v·ªõi Shop Game Dopi!</h1>
                    <div class="text-left max-w-4xl mx-auto mb-8">
                        <p class="text-lg mb-4 opacity-90">Shop Game Dopi l√† n·ªÅn t·∫£ng chuy√™n cung c·∫•p c√°c game online b·∫£n quy·ªÅn gi√° r·∫ª v√† game MOD v·ªõi nhi·ªÅu t√≠nh nƒÉng h·∫•p d·∫´n. V·ªõi m·ª•c ti√™u mang ƒë·∫øn cho c·ªông ƒë·ªìng game th·ªß nh·ªØng t·ª±a game ch·∫•t l∆∞·ª£ng v·ªõi chi ph√≠ t·ªëi ∆∞u nh·∫•t, ch√∫ng t√¥i lu√¥n c·∫≠p nh·∫≠t li√™n t·ª•c c√°c s·∫£n ph·∫©m m·ªõi nh·∫•t, bao g·ªìm:</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                <p class="text-green-300">‚úÖ Game online c√≥ b·∫£n quy·ªÅn v·ªõi gi√° r·∫ª h∆°n th·ªã tr∆∞·ªùng</p>
                            </div>
                            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                <p class="text-green-300">‚úÖ Game MOD m·ªü kh√≥a full t√≠nh nƒÉng, kh√¥ng qu·∫£ng c√°o</p>
                            </div>
                            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                <p class="text-green-300">‚úÖ C√°c game mi·ªÖn ph√≠ ƒë∆∞·ª£c ƒë√≥ng g√≥i v√† h·ªó tr·ª£ c√†i ƒë·∫∑t d·ªÖ d√†ng</p>
                            </div>
                            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                <p class="text-green-300">‚úÖ H·ªó tr·ª£ 1:1 khi b·∫°n g·∫∑p s·ª± c·ªë trong qu√° tr√¨nh t·∫£i v√† ch∆°i game</p>
                            </div>
                        </div>
                        
                        <div class="bg-blue-600 bg-opacity-20 border border-blue-400 rounded-lg p-4 mb-4">
                            <h3 class="text-xl font-bold mb-2">üöÄ Lu√¥n c·∫≠p nh·∫≠t game m·ªõi m·ªói tu·∫ßn!</h3>
                            <p class="mb-2">Ch√∫ng t√¥i th∆∞·ªùng xuy√™n b·ªï sung c√°c t·ª±a game m·ªõi nh·∫•t v√† c√°c phi√™n b·∫£n MOD ƒë√£ ƒë∆∞·ª£c tinh ch·ªânh ƒë·∫∑c bi·ªát. ƒê·ªÉ kh√¥ng b·ªè l·ª°:</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                <p>üîî C·∫≠p nh·∫≠t game hot, b·∫£n MOD an to√†n, t·ªëi ∆∞u hi·ªáu nƒÉng</p>
                                <p>üí¨ Th√¥ng b√°o khi c√≥ ƒë·ª£t khuy·∫øn m√£i, gi·∫£m gi√° s·ªëc</p>
                                <p>üì• T·∫£i s·ªõm c√°c game y√™u th√≠ch v·ªõi t·ªëc ƒë·ªô cao</p>
                                <p>ü§ù ∆Øu ti√™n h·ªó tr·ª£ cho ng∆∞·ªùi d√πng ƒëƒÉng nh·∫≠p th∆∞·ªùng xuy√™n</p>
                            </div>
                        </div>
                        
                        <p class="text-center text-lg opacity-90">üëâ H√£y gh√© thƒÉm website m·ªói ng√†y ho·∫∑c l∆∞u trang v√†o d·∫•u trang ƒë·ªÉ nh·∫≠n th√¥ng b√°o c·∫≠p nh·∫≠t game s·ªõm nh·∫•t!</p>
                    </div>
                    
                    <div class="bg-yellow-400 text-yellow-900 px-6 py-3 rounded-lg inline-block font-semibold">
                        üéâ KHUY·∫æN M√ÉI: Gi·∫£m gi√° ƒë·∫∑c bi·ªát cho t·∫•t c·∫£ game v√† tool!
                    </div>
                </div>
            </div>

            <!-- Featured Games Carousel -->
            <div class="max-w-7xl mx-auto px-4 py-16">
                <h2 class="text-3xl font-bold text-center mb-12 text-gray-800">Game n·ªïi b·∫≠t</h2>
                <div class="relative">
                    <!-- Carousel Container -->
                    <div class="overflow-hidden rounded-xl">
                        <div id="featuredCarousel" class="flex transition-transform duration-500 ease-in-out">
                            <!-- Games will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Navigation Arrows -->
                    <button id="prevBtn" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-90 hover:bg-opacity-100 text-gray-800 w-12 h-12 rounded-full shadow-lg flex items-center justify-center transition-all z-10">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button id="nextBtn" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-90 hover:bg-opacity-100 text-gray-800 w-12 h-12 rounded-full shadow-lg flex items-center justify-center transition-all z-10">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    
                    <!-- Dots Indicator -->
                    <div id="carouselDots" class="flex justify-center mt-6 space-x-2">
                        <!-- Dots will be generated here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Games Section -->
        <section id="gamesSection" class="section hidden">
            <div class="max-w-7xl mx-auto px-4 py-16">
                <h2 class="text-3xl font-bold mb-8 text-gray-800">T·∫•t c·∫£ Game</h2>
                <div class="mb-8 flex flex-wrap gap-4">
                    <select id="categoryFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>
                        <option value="simulation">M√¥ ph·ªèng</option>
                        <option value="moba">MOBA</option>
                        <option value="casual">Gi·∫£i tr√≠</option>
                        <option value="sandbox">Sandbox</option>
                        <option value="battle-royale">Battle Royale</option>
                        <option value="utility">Ti·ªán √≠ch</option>
                        <option value="sports">Th·ªÉ thao</option>
                    </select>
                    <select id="priceFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">T·∫•t c·∫£ gi√°</option>
                        <option value="0-500000">D∆∞·ªõi 500K</option>
                        <option value="500000-1000000">500K - 1M</option>
                        <option value="1000000-1500000">1M - 1.5M</option>
                        <option value="1500000-999999999">Tr√™n 1.5M</option>
                    </select>
                    <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm game..." class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent flex-1 min-w-64">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8" id="allGames">
                    <!-- Games will be loaded here -->
                </div>
            </div>
        </section>



        <!-- Mini Games Section -->
        <section id="minigamesSection" class="section hidden">
            <div class="max-w-7xl mx-auto px-4 py-16">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-4 text-gray-800">üå± Game Tr·ªìng C√¢y</h2>
                    <p class="text-lg text-gray-600 max-w-2xl mx-auto">Nu√¥i d∆∞·ª°ng c√¢y c·ªßa b·∫°n v√† nh·∫≠n th∆∞·ªüng! C√†ng chƒÉm s√≥c nhi·ªÅu, ph·∫ßn th∆∞·ªüng c√†ng l·ªõn!</p>
                </div>

                <!-- Tree Game Card -->
                <div class="max-w-4xl mx-auto">
                    <div class="dark-card p-8 text-center">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Tree Display -->
                            <div class="text-center">
                                <div class="mb-6">
                                    <div id="treeDisplay" class="text-8xl mb-4">üå±</div>
                                    <h3 class="text-2xl font-bold text-white mb-2">C√¢y c·ªßa b·∫°n</h3>
                                    <div class="bg-gray-800 rounded-lg p-4 mb-4">
                                        <div class="grid grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <p class="text-gray-400">C·∫•p ƒë·ªô</p>
                                                <p class="text-2xl font-bold text-green-400" id="treeLevel">1</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-400">T·ªïng EXP</p>
                                                <p class="text-xl font-bold text-blue-400" id="totalExp">0</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- EXP Progress Bar -->
                                    <div class="mb-4">
                                        <div class="flex justify-between text-sm text-gray-300 mb-1">
                                            <span>EXP ti·∫øn ƒë·ªô</span>
                                            <span id="expProgress">0 / 47,000</span>
                                        </div>
                                        <div class="w-full bg-gray-700 rounded-full h-3">
                                            <div id="expBar" class="bg-gradient-to-r from-green-500 to-blue-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                                        </div>
                                    </div>

                                    <!-- Level Up Button -->
                                    <div id="levelUpSection" class="hidden mb-4">
                                        <div class="bg-yellow-600 bg-opacity-20 border border-yellow-500 rounded-lg p-4 mb-3">
                                            <p class="text-yellow-200 font-bold">üéâ ƒê·ªß EXP ƒë·ªÉ l√™n c·∫•p!</p>
                                            <p class="text-sm text-yellow-300">Nh·∫•n n√∫t ƒë·ªÉ th·ª≠ v·∫≠n may n√¢ng c·∫•p</p>
                                        </div>
                                        <button onclick="attemptLevelUp()" class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-6 py-3 rounded-lg font-bold hover:from-yellow-600 hover:to-orange-600 transition-all">
                                            <i class="fas fa-arrow-up mr-2"></i>N√¢ng C·∫•p
                                        </button>
                                    </div>

                                    <!-- Rewards Info -->
                                    <div class="bg-purple-600 bg-opacity-20 border border-purple-500 rounded-lg p-4">
                                        <p class="text-purple-200 font-bold mb-2">üéÅ Ph·∫ßn th∆∞·ªüng ti·∫øp theo</p>
                                        <p class="text-sm text-purple-300" id="nextReward">C·∫•p 5: 500,000 VNƒê</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Care Actions -->
                            <div>
                                <h3 class="text-xl font-bold text-white mb-6">üíß ChƒÉm s√≥c c√¢y</h3>
                                
                                <!-- Care Options -->
                                <div class="space-y-4 mb-6">
                                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-600">
                                        <div class="flex justify-between items-center mb-2">
                                            <div>
                                                <p class="text-white font-semibold">T∆∞·ªõi n∆∞·ªõc c∆° b·∫£n</p>
                                                <p class="text-sm text-gray-400">+100 EXP</p>
                                            </div>
                                            <div class="text-right">
                                                <p class="text-green-400 font-bold">1,000 VNƒê</p>
                                            </div>
                                        </div>
                                        <button onclick="careForTree(100, 1000)" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                            <i class="fas fa-tint mr-2"></i>T∆∞·ªõi n∆∞·ªõc
                                        </button>
                                    </div>

                                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-600">
                                        <div class="flex justify-between items-center mb-2">
                                            <div>
                                                <p class="text-white font-semibold">B√≥n ph√¢n ƒë·∫∑c bi·ªát</p>
                                                <p class="text-sm text-gray-400">+1,000 EXP</p>
                                            </div>
                                            <div class="text-right">
                                                <p class="text-green-400 font-bold">10,000 VNƒê</p>
                                            </div>
                                        </div>
                                        <button onclick="careForTree(1000, 10000)" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors">
                                            <i class="fas fa-seedling mr-2"></i>B√≥n ph√¢n
                                        </button>
                                    </div>
                                </div>

                                <!-- Daily Missions -->
                                <div class="bg-purple-600 bg-opacity-20 border border-purple-500 rounded-lg p-4 mb-4">
                                    <h4 class="text-purple-200 font-bold mb-3">üéØ Nhi·ªám v·ª• h√†ng ng√†y</h4>
                                    <div id="dailyMissions" class="space-y-2">
                                        <!-- Missions will be loaded here -->
                                    </div>
                                </div>

                                <!-- Free Care Actions -->
                                <div class="bg-green-600 bg-opacity-20 border border-green-500 rounded-lg p-4 mb-4">
                                    <h4 class="text-green-200 font-bold mb-3">üÜì L∆∞·ª£t chƒÉm s√≥c mi·ªÖn ph√≠</h4>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="text-center">
                                            <div class="bg-blue-500 bg-opacity-30 rounded-lg p-3">
                                                <i class="fas fa-tint text-blue-300 text-xl mb-1"></i>
                                                <p class="text-blue-200 text-sm">L∆∞·ª£t t∆∞·ªõi n∆∞·ªõc</p>
                                                <p class="text-white font-bold text-lg" id="freeWaterCount">0</p>
                                                <button onclick="useFreeWater()" id="freeWaterBtn" class="mt-2 bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                                    T∆∞·ªõi mi·ªÖn ph√≠
                                                </button>
                                            </div>
                                        </div>
                                        <div class="text-center">
                                            <div class="bg-green-500 bg-opacity-30 rounded-lg p-3">
                                                <i class="fas fa-seedling text-green-300 text-xl mb-1"></i>
                                                <p class="text-green-200 text-sm">L∆∞·ª£t b√≥n ph√¢n</p>
                                                <p class="text-white font-bold text-lg" id="freeFertilizerCount">0</p>
                                                <button onclick="useFreeFertilizer()" id="freeFertilizerBtn" class="mt-2 bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                                    B√≥n mi·ªÖn ph√≠
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Simple Guide -->
                                <div class="bg-amber-600 bg-opacity-20 border border-amber-500 rounded-lg p-4">
                                    <h4 class="text-amber-200 font-bold mb-2">üå± H∆∞·ªõng d·∫´n</h4>
                                    <p class="text-sm text-amber-200">H√£y chƒÉm ch·ªâ t∆∞·ªõi n∆∞·ªõc ƒë·ªÉ ƒë∆∞·ª£c nh·∫≠n qu√†! Ho√†n th√†nh nhi·ªám v·ª• h√†ng ng√†y ƒë·ªÉ nh·∫≠n th√™m l∆∞·ª£t chƒÉm s√≥c mi·ªÖn ph√≠.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Achievement History -->
                    <div class="mt-8 dark-card p-6">
                        <h3 class="text-xl font-bold text-white mb-4">üèÜ L·ªãch s·ª≠ th√†nh t√≠ch</h3>
                        <div id="achievementHistory" class="space-y-2 max-h-40 overflow-y-auto">
                            <p class="text-gray-400 text-center py-4">Ch∆∞a c√≥ th√†nh t√≠ch n√†o</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profileSection" class="section hidden">
            <div class="max-w-6xl mx-auto px-4 py-16">
                <h2 class="text-3xl font-bold mb-8 text-gray-800 text-center">H·ªì s∆° c√° nh√¢n</h2>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- User Info Card -->
                    <div class="profile-card text-white rounded-xl shadow-lg p-8 relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white bg-opacity-10 rounded-full -mr-16 -mt-16"></div>
                        <div class="absolute bottom-0 left-0 w-24 h-24 bg-white bg-opacity-10 rounded-full -ml-12 -mb-12"></div>
                        <div class="relative z-10">
                            <div class="w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-user text-3xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-center mb-6">Th√¥ng tin t√†i kho·∫£n</h3>
                            <div class="space-y-4">
                                <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                    <p class="text-sm opacity-80">Email</p>
                                    <p class="font-semibold" id="userEmail">ƒêang t·∫£i...</p>
                                </div>
                                <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                    <p class="text-sm opacity-80">S·ªë d∆∞ hi·ªán t·∫°i</p>
                                    <p class="text-2xl font-bold" id="profileBalance">ƒêang t·∫£i...</p>
                                </div>
                                <button onclick="showTopup()" class="w-full bg-white text-blue-600 py-3 px-4 rounded-lg hover:bg-blue-50 transition-colors font-semibold mb-3">
                                    <i class="fas fa-plus mr-2"></i>N·∫°p ti·ªÅn
                                </button>
                                <a href="https://t.me/tomxinh917" target="_blank" rel="noopener noreferrer" class="w-full bg-blue-500 text-white py-3 px-4 rounded-lg hover:bg-blue-600 transition-colors font-semibold flex items-center justify-center">
                                    <i class="fab fa-telegram-plane mr-2"></i>Li√™n h·ªá Telegram
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Transaction History -->
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-8">
                        <div class="flex items-center justify-between mb-6">
                            <h3 id="transactionTitle" class="text-2xl font-bold text-gray-800">L·ªãch s·ª≠ n·∫°p ti·ªÅn</h3>
                            <button onclick="loadTransactionHistory()" class="text-blue-600 hover:text-blue-800 transition-colors">
                                <i class="fas fa-sync-alt mr-1"></i>L√†m m·ªõi
                            </button>
                        </div>
                        
                        <!-- Transaction Tabs -->
                        <div class="flex border-b border-gray-200 mb-6">
                            <button id="topupTab" onclick="showTransactionTab('topup')" class="transaction-tab px-4 py-2 border-b-2 border-blue-600 text-blue-600 font-medium transition-colors">
                                <i class="fas fa-plus-circle mr-2"></i>L·ªãch s·ª≠ n·∫°p ti·ªÅn
                            </button>
                            <button id="purchaseTab" onclick="showTransactionTab('purchase')" class="transaction-tab px-4 py-2 border-b-2 border-transparent text-gray-500 font-medium transition-colors ml-4">
                                <i class="fas fa-shopping-cart mr-2"></i>L·ªãch s·ª≠ mua h√†ng
                            </button>
                        </div>
                        
                        <div id="transactionHistory" class="space-y-3 max-h-96 overflow-y-auto">
                            <div class="text-center text-gray-500 py-8">
                                <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                <p>ƒêang t·∫£i l·ªãch s·ª≠ giao d·ªãch...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="gradient-bg text-white py-8 mt-16">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <div class="flex items-center justify-center mb-4">
                <i class="fas fa-gamepad text-2xl mr-3"></i>
                <span class="text-xl font-bold">GameStore</span>
            </div>
            <p class="text-gray-300 mb-4">C·ª≠a h√†ng game online uy t√≠n - Gi√° t·ªët nh·∫•t th·ªã tr∆∞·ªùng</p>
            <div class="border-t border-gray-600 pt-4">
                <p class="text-sm text-gray-400">¬© 2025 Dopi Team. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content rounded-lg p-8 max-w-md w-full mx-4 relative shadow-2xl">
            <button onclick="closeModal('loginModal')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-300 text-xl">
                <i class="fas fa-times"></i>
            </button>
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-blue-600 bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user text-blue-400 text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-white">ƒêƒÉng nh·∫≠p</h2>
                <p class="text-gray-300 mt-2">Ch√†o m·ª´ng b·∫°n quay tr·ªü l·∫°i!</p>
            </div>
            <form id="loginForm" class="space-y-5">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                    <input type="email" id="loginEmail" required placeholder="Nh·∫≠p email c·ªßa b·∫°n" class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-gray-800 text-white">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">M·∫≠t kh·∫©u</label>
                    <input type="password" id="loginPassword" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u" class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-gray-800 text-white">
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                    ƒêƒÉng nh·∫≠p
                </button>
            </form>
            <div class="mt-6 text-center">
                <button onclick="closeModal('loginModal'); showRegister();" class="text-blue-400 hover:text-blue-300 font-medium">
                    Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω ngay
                </button>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content rounded-lg p-8 max-w-md w-full mx-4 relative shadow-2xl">
            <button onclick="closeModal('registerModal')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-300 text-xl">
                <i class="fas fa-times"></i>
            </button>
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-green-600 bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user-plus text-green-400 text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-white">ƒêƒÉng k√Ω</h2>
                <p class="text-gray-300 mt-2">T·∫°o t√†i kho·∫£n m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu!</p>
            </div>
            <form id="registerForm" class="space-y-5">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                    <input type="email" id="registerEmail" required placeholder="Nh·∫≠p email c·ªßa b·∫°n" class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-gray-800 text-white">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">M·∫≠t kh·∫©u</label>
                    <input type="password" id="registerPassword" required minlength="6" placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±" class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-gray-800 text-white">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                    <input type="password" id="confirmPassword" required minlength="6" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u" class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-gray-800 text-white">
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                    ƒêƒÉng k√Ω
                </button>
            </form>
            <div class="mt-6 text-center">
                <button onclick="closeModal('registerModal'); showLogin();" class="text-blue-400 hover:text-blue-300 font-medium">
                    ƒê√£ c√≥ t√†i kho·∫£n? ƒêƒÉng nh·∫≠p
                </button>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
        <div class="modal-content rounded-lg p-8 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
            <h2 class="text-2xl font-bold mb-6 text-center text-white">Gi·ªè h√†ng</h2>
            <div id="cartItems" class="space-y-4 mb-6">
                <!-- Cart items will be loaded here -->
            </div>
            <div class="border-t border-gray-600 pt-4">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-lg font-semibold text-white">T·ªïng c·ªông:</span>
                    <span id="cartTotal" class="text-xl font-bold text-blue-400">0 VNƒê</span>
                </div>
                <div class="flex gap-4">
                    <button onclick="closeModal('cartModal')" class="flex-1 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">
                        ƒê√≥ng
                    </button>
                    <button onclick="checkout()" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                        Thanh to√°n
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Topup Modal -->
    <div id="topupModal" class="modal">
        <div class="modal-content rounded-lg p-4 sm:p-6 max-w-lg w-full mx-2 sm:mx-4 relative shadow-2xl max-h-screen overflow-y-auto">
            <button onclick="closeModal('topupModal')" class="absolute top-3 right-3 text-gray-400 hover:text-gray-300 text-xl z-10">
                <i class="fas fa-times"></i>
            </button>
            <div class="text-center mb-4">
                <div class="w-12 h-12 bg-green-600 bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-wallet text-green-400 text-xl"></i>
                </div>
                <h2 class="text-xl font-bold text-white">N·∫°p ti·ªÅn</h2>
                <p class="text-gray-300 mt-1 text-sm">G·ª≠i y√™u c·∫ßu n·∫°p ti·ªÅn v√†o t√†i kho·∫£n</p>
            </div>
            
            <!-- Quick Amount Buttons -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-300 mb-2">Ch·ªçn nhanh s·ªë ti·ªÅn:</label>
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
                    <button type="button" onclick="selectAmount(50000)" class="amount-btn px-2 py-2 border border-gray-600 rounded-lg text-xs sm:text-sm transition-colors">50K</button>
                    <button type="button" onclick="selectAmount(100000)" class="amount-btn px-2 py-2 border border-gray-600 rounded-lg text-xs sm:text-sm transition-colors">100K</button>
                    <button type="button" onclick="selectAmount(200000)" class="amount-btn px-2 py-2 border border-gray-600 rounded-lg text-xs sm:text-sm transition-colors">200K</button>
                    <button type="button" onclick="selectAmount(500000)" class="amount-btn px-2 py-2 border border-gray-600 rounded-lg text-xs sm:text-sm transition-colors">500K</button>
                    <button type="button" onclick="selectAmount(1000000)" class="amount-btn px-2 py-2 border border-gray-600 rounded-lg text-xs sm:text-sm transition-colors">1M</button>
                    <button type="button" onclick="selectAmount(2000000)" class="amount-btn px-2 py-2 border border-gray-600 rounded-lg text-xs sm:text-sm transition-colors">2M</button>
                </div>
            </div>

            <div id="topupStep1">
                <form id="topupForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">S·ªë ti·ªÅn (VNƒê)</label>
                        <input type="number" id="topupAmount" required min="10000" step="1000" placeholder="T·ªëi thi·ªÉu 10,000 VNƒê" class="w-full px-3 py-2 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm bg-gray-800 text-white">
                    </div>
                    
                    <!-- S·ªë d∆∞ hi·ªán t·∫°i -->
                    <div class="bg-blue-600 bg-opacity-20 border border-blue-500 rounded-lg p-3">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-blue-300">S·ªë d∆∞ hi·ªán t·∫°i:</span>
                            <span class="font-bold text-blue-200" id="currentBalanceInModal">0 VNƒê</span>
                        </div>
                    </div>
                    
                    <div class="bg-amber-600 bg-opacity-20 border border-amber-500 rounded-lg p-3">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-amber-400 mt-0.5 mr-2 text-sm"></i>
                            <div class="text-xs text-amber-200">
                                <p class="font-medium mb-1">üìã H∆∞·ªõng d·∫´n n·∫°p ti·ªÅn:</p>
                                <p class="mb-1">1. Nh·∫≠p s·ªë ti·ªÅn mu·ªën n·∫°p</p>
                                <p class="mb-1">2. Nh·∫≠n th√¥ng tin chuy·ªÉn kho·∫£n</p>
                                <p class="mb-2">3. Chuy·ªÉn kho·∫£n v√† ch·ªù x·ª≠ l√Ω</p>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium text-sm">
                        <i class="fas fa-arrow-right mr-2"></i>Ti·∫øp t·ª•c
                    </button>
                </form>
            </div>

            <!-- Bank Info Step -->
            <div id="topupStep2" class="hidden">
                <div class="bank-info rounded-lg p-4 mb-4">
                    <h3 class="text-lg font-bold text-white mb-3 text-center">
                        <i class="fas fa-university mr-2"></i>Th√¥ng tin chuy·ªÉn kho·∫£n
                    </h3>
                    
                    <div class="space-y-3">
                        <div class="bg-white bg-opacity-10 rounded-lg p-3">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-xs text-blue-200 mb-1">S·ªë t√†i kho·∫£n</p>
                                    <p class="font-mono text-lg font-bold text-white" id="bankAccount">345678159999</p>
                                </div>
                                <button onclick="copyToClipboard('345678159999')" class="copy-btn px-3 py-2 rounded-lg text-xs">
                                    <i class="fas fa-copy mr-1"></i>Copy
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-white bg-opacity-10 rounded-lg p-3">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-xs text-blue-200 mb-1">Ng√¢n h√†ng</p>
                                    <p class="font-semibold text-white">TECHCOMBANK</p>
                                </div>
                                <button onclick="copyToClipboard('TECHCOMBANK')" class="copy-btn px-3 py-2 rounded-lg text-xs">
                                    <i class="fas fa-copy mr-1"></i>Copy
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-white bg-opacity-10 rounded-lg p-3">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-xs text-blue-200 mb-1">Ch·ªß t√†i kho·∫£n</p>
                                    <p class="font-semibold text-white">NGUYEN HO GIA BAO</p>
                                </div>
                                <button onclick="copyToClipboard('NGUYEN HO GIA BAO')" class="copy-btn px-3 py-2 rounded-lg text-xs">
                                    <i class="fas fa-copy mr-1"></i>Copy
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-white bg-opacity-10 rounded-lg p-3">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-xs text-blue-200 mb-1">S·ªë ti·ªÅn</p>
                                    <p class="font-bold text-xl text-green-300" id="transferAmount">0 VNƒê</p>
                                </div>
                                <button onclick="copyAmount()" class="copy-btn px-3 py-2 rounded-lg text-xs">
                                    <i class="fas fa-copy mr-1"></i>Copy
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-white bg-opacity-10 rounded-lg p-3">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-xs text-blue-200 mb-1">N·ªôi dung chuy·ªÉn kho·∫£n</p>
                                    <p class="font-mono text-sm text-white" id="transferContent">email@example.com</p>
                                </div>
                                <button onclick="copyContent()" class="copy-btn px-3 py-2 rounded-lg text-xs">
                                    <i class="fas fa-copy mr-1"></i>Copy
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-green-600 bg-opacity-20 border border-green-500 rounded-lg p-3 mb-4">
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-400 mt-0.5 mr-2"></i>
                        <div class="text-xs text-green-200">
                            <p class="font-medium mb-1">‚úÖ L∆∞u √Ω quan tr·ªçng:</p>
                            <p class="mb-1">‚Ä¢ Chuy·ªÉn kho·∫£n ƒë√∫ng s·ªë ti·ªÅn v√† n·ªôi dung</p>
                            <p class="mb-1">‚Ä¢ Ti·ªÅn s·∫Ω ƒë∆∞·ª£c c·ªông t·ª± ƒë·ªông sau khi chuy·ªÉn</p>
                            <p>‚Ä¢ Th·ªùi gian x·ª≠ l√Ω: 1-5 ph√∫t</p>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-3">
                    <button onclick="backToStep1()" class="flex-1 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors text-sm">
                        <i class="fas fa-arrow-left mr-2"></i>Quay l·∫°i
                    </button>
                    <button onclick="confirmTopup()" class="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors text-sm">
                        <i class="fas fa-paper-plane mr-2"></i>T·∫°o y√™u c·∫ßu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Purchase Details Modal -->
    <div id="purchaseDetailsModal" class="modal">
        <div class="modal-content rounded-lg p-6 max-w-2xl w-full mx-4 relative shadow-2xl max-h-screen overflow-y-auto">
            <button onclick="closeModal('purchaseDetailsModal')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-300 text-xl">
                <i class="fas fa-times"></i>
            </button>
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-blue-600 bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-receipt text-blue-400 text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-white">Chi ti·∫øt ƒë∆°n h√†ng</h2>
                <p class="text-gray-300 mt-2">Th√¥ng tin t√†i kho·∫£n game ƒë√£ mua</p>
            </div>
            
            <div id="purchaseDetailsContent" class="space-y-4">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Welcome Banner Modal -->
    <div id="welcomeBanner" class="modal show">
        <div class="modal-content rounded-xl p-8 max-w-2xl w-full mx-4 relative shadow-2xl bg-gradient-to-br from-blue-600 to-purple-600 text-white border-none">
            <button onclick="closeWelcomeBanner()" class="absolute top-4 right-4 text-white hover:text-gray-200 text-2xl">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="text-center">
                <div class="w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-gamepad text-4xl"></i>
                </div>
                
                <h2 class="text-3xl font-bold mb-4">üéÆ Ch√†o m·ª´ng ƒë·∫øn Shop Game Dopi!</h2>
                
                <div class="bg-white bg-opacity-10 rounded-lg p-6 mb-6 text-left">
                    <h3 class="text-xl font-bold mb-4 text-center">üî• ∆Øu ƒë√£i ƒë·∫∑c bi·ªát h√¥m nay!</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="bg-green-500 bg-opacity-20 rounded-lg p-3 border border-green-400">
                            <p class="font-semibold text-green-200">üéØ ETS2 Mods</p>
                            <p class="text-sm">Gi·∫£m t·ªõi 75% t·∫•t c·∫£ mod ETS2</p>
                        </div>
                        <div class="bg-red-500 bg-opacity-20 rounded-lg p-3 border border-red-400">
                            <p class="font-semibold text-red-200">‚öîÔ∏è Game Hack</p>
                            <p class="text-sm">Tool hack game gi·∫£m 50%</p>
                        </div>
                        <div class="bg-yellow-500 bg-opacity-20 rounded-lg p-3 border border-yellow-400">
                            <p class="font-semibold text-yellow-200">üÜì Game Free</p>
                            <p class="text-sm">Minecraft iOS ho√†n to√†n mi·ªÖn ph√≠</p>
                        </div>
                        <div class="bg-purple-500 bg-opacity-20 rounded-lg p-3 border border-purple-400">
                            <p class="font-semibold text-purple-200">üé± Thu√™ Account</p>
                            <p class="text-sm">Pool account t·ª´ 35K/gi·ªù</p>
                        </div>
                    </div>
                    
                    <div class="bg-orange-500 bg-opacity-20 border border-orange-400 rounded-lg p-4">
                        <div class="flex items-center justify-center">
                            <i class="fas fa-gift text-orange-300 text-2xl mr-3"></i>
                            <div>
                                <p class="font-bold text-orange-200">üéÅ T·∫∑ng k√®m mi·ªÖn ph√≠:</p>
                                <p class="text-sm text-orange-100">Video h∆∞·ªõng d·∫´n + Support 1:1 + B·∫£o h√†nh tr·ªçn ƒë·ªùi</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-4 justify-center">
                    <button onclick="closeWelcomeBanner(); showSection('games')" class="bg-white text-blue-600 px-6 py-3 rounded-lg hover:bg-blue-50 transition-colors font-semibold">
                        <i class="fas fa-shopping-bag mr-2"></i>Mua ngay
                    </button>
                    <button onclick="closeWelcomeBanner()" class="bg-white bg-opacity-20 text-white px-6 py-3 rounded-lg hover:bg-opacity-30 transition-colors font-semibold">
                        <i class="fas fa-eye mr-2"></i>Xem sau
                    </button>
                </div>
                
                <p class="text-sm opacity-80 mt-4">
                    <i class="fas fa-clock mr-1"></i>∆Øu ƒë√£i c√≥ th·ªùi h·∫°n - Nhanh tay k·∫ªo l·ª°!
                </p>
            </div>
        </div>
    </div>

    <!-- Game Modal -->
    <div id="gameModal" class="modal">
        <div class="modal-content rounded-lg p-6 max-w-4xl w-full mx-4 relative shadow-2xl max-h-screen overflow-y-auto">
            <button onclick="closeGame()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-300 text-xl z-10">
                <i class="fas fa-times"></i>
            </button>
            <div id="gameContainer" class="text-center">
                <!-- Game content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <!-- Telegram Floating Button -->
    <a href="https://t.me/tomxinh917" target="_blank" rel="noopener noreferrer" class="telegram-float">
        <div class="telegram-tooltip">Li√™n h·ªá h·ªó tr·ª£ Telegram</div>
        <i class="fab fa-telegram-plane"></i>
    </a>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDNFfK_I72c277obUljfIfZJ4e2pHBR0pg",
            authDomain: "shopgame-dopi.firebaseapp.com",
            databaseURL: "https://shopgame-dopi-default-rtdb.firebaseio.com",
            projectId: "shopgame-dopi",
            storageBucket: "shopgame-dopi.firebasestorage.app",
            messagingSenderId: "205236033379",
            appId: "1:205236033379:web:9a6ff9a9194bf8f2c92556",
            measurementId: "G-QRN71J96RY"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global variables
        let currentUser = null;
        let cart = [];
        let games = [];
        let userDataListener = null;
        let transactionListener = null;
        let topupListener = null;
        let currentTransactionTab = 'topup';
        let userVouchers = [];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('App initializing...');
            
            // Check if welcome banner should be shown
            if (sessionStorage.getItem('welcomeBannerShown')) {
                document.getElementById('welcomeBanner').classList.remove('show');
            }
            
            initializeApp();
            setupEventListeners();
            loadSampleGames();
            initSnowEffect();
        });

        function initializeApp() {
            auth.onAuthStateChanged(user => {
                console.log('Auth state changed:', user ? user.email : 'No user');
                
                // Cleanup previous listeners
                if (userDataListener) userDataListener();
                if (transactionListener) transactionListener();
                if (topupListener) topupListener();
                
                if (user) {
                    currentUser = user;
                    showUserNav();
                    loadUserData();
                    loadUserVouchers();
                    loadTreeGameData();
                } else {
                    currentUser = null;
                    showGuestNav();
                    // Reset UI when logged out
                    document.getElementById('userEmail').textContent = '-';
                    updateBalanceDisplay(0);
                    document.getElementById('transactionHistory').innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-receipt text-4xl mb-4 opacity-50"></i>
                            <p>Ch∆∞a c√≥ giao d·ªãch n√†o</p>
                        </div>
                    `;
                }
            });
        }

        function setupEventListeners() {
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('topupForm').addEventListener('submit', handleTopup);
            document.getElementById('searchInput').addEventListener('input', filterGames);
            document.getElementById('categoryFilter').addEventListener('change', filterGames);
            document.getElementById('priceFilter').addEventListener('change', filterGames);
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
            
            // Close mobile menu when clicking outside (handled by overlay click)

            // Close mobile menu on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const mobileMenu = document.getElementById('mobileMenu');
                    if (mobileMenu && mobileMenu.classList.contains('mobile-menu-open')) {
                        closeMobileMenu();
                    }
                }
            });
        }

        // Authentication functions
        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const submitBtn = e.target.querySelector('button[type="submit"]');

            if (!email || !password) {
                showNotification('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
                return;
            }

            // Show loading state
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<div class="loading"></div> ƒêang ƒëƒÉng nh·∫≠p...';
            submitBtn.disabled = true;

            try {
                await auth.signInWithEmailAndPassword(email, password);
                closeModal('loginModal');
                showNotification('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!', 'success');
                document.getElementById('loginForm').reset();
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i!';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i!';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email kh√¥ng h·ª£p l·ªá!';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Qu√° nhi·ªÅu l·∫ßn th·ª≠. Vui l√≤ng th·ª≠ l·∫°i sau!';
                }
                showNotification(errorMessage, 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const submitBtn = e.target.querySelector('button[type="submit"]');

            if (!email || !password || !confirmPassword) {
                showNotification('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showNotification('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!', 'error');
                return;
            }

            if (password.length < 6) {
                showNotification('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!', 'error');
                return;
            }

            // Show loading state
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<div class="loading"></div> ƒêang ƒëƒÉng k√Ω...';
            submitBtn.disabled = true;

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                console.log('User created:', userCredential.user.uid);
                
                // Create user document in Firestore
                await db.collection('users').doc(userCredential.user.uid).set({
                    email: email,
                    balance: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log('User document created in Firestore');

                closeModal('registerModal');
                showNotification('ƒêƒÉng k√Ω th√†nh c√¥ng!', 'success');
                document.getElementById('registerForm').reset();
            } catch (error) {
                console.error('Register error:', error);
                let errorMessage = 'ƒêƒÉng k√Ω th·∫•t b·∫°i!';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng!';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email kh√¥ng h·ª£p l·ªá!';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'M·∫≠t kh·∫©u qu√° y·∫øu!';
                }
                showNotification(errorMessage, 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        function logout() {
            auth.signOut();
            showSection('home');
            showNotification('ƒê√£ ƒëƒÉng xu·∫•t!', 'success');
        }

        // User interface functions
        function showUserNav() {
            document.getElementById('userNav').classList.remove('hidden');
            document.getElementById('userNav').classList.add('flex');
            document.getElementById('guestNav').classList.add('hidden');
            
            // Mobile nav
            document.getElementById('mobileUserNav').classList.remove('hidden');
            document.getElementById('mobileGuestNav').classList.add('hidden');
        }

        function showGuestNav() {
            document.getElementById('userNav').classList.add('hidden');
            document.getElementById('guestNav').classList.remove('hidden');
            
            // Mobile nav
            document.getElementById('mobileUserNav').classList.add('hidden');
            document.getElementById('mobileGuestNav').classList.remove('hidden');
        }

        // Mobile menu functions
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const isOpen = mobileMenu.classList.contains('mobile-menu-open');
            
            if (isOpen) {
                closeMobileMenu();
            } else {
                openMobileMenu();
            }
        }

        function openMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            
            mobileMenu.classList.add('mobile-menu-open');
            mobileMenuOverlay.classList.add('show');
            
            // Change hamburger to X
            mobileMenuBtn.innerHTML = '<i class="fas fa-times text-xl"></i>';
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
        }

        function closeMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            
            mobileMenu.classList.remove('mobile-menu-open');
            mobileMenuOverlay.classList.remove('show');
            
            // Change X back to hamburger
            mobileMenuBtn.innerHTML = '<i class="fas fa-bars text-xl"></i>';
            
            // Restore body scroll
            document.body.style.overflow = '';
        }

        async function loadUserData() {
            if (!currentUser) {
                console.log('No current user');
                return;
            }

            console.log('Loading user data for:', currentUser.uid);

            try {
                // Set email immediately from auth
                document.getElementById('userEmail').textContent = currentUser.email;
                
                // Load transactions from localStorage first
                loadTransactionsFromStorage();
                
                // Listen for real-time updates to user document
                userDataListener = db.collection('users').doc(currentUser.uid).onSnapshot((doc) => {
                    console.log('User document snapshot:', doc.exists, doc.data());
                    
                    if (doc.exists) {
                        const userData = doc.data();
                        const balance = userData.balance || 0;
                        updateBalanceDisplay(balance);
                        console.log('Updated balance display:', balance);
                    } else {
                        console.log('User document does not exist, creating...');
                        // Create user document if it doesn't exist
                        db.collection('users').doc(currentUser.uid).set({
                            email: currentUser.email,
                            balance: 0,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        }).then(() => {
                            console.log('User document created');
                        }).catch(error => {
                            console.error('Error creating user document:', error);
                        });
                    }
                }, (error) => {
                    console.error('Error listening to user document:', error);
                });
                
                // Load transaction history
                loadTransactionHistory();
                
            } catch (error) {
                console.error('Error loading user data:', error);
                showNotification('L·ªói t·∫£i d·ªØ li·ªáu ng∆∞·ªùi d√πng', 'error');
            }
        }

        function updateBalanceDisplay(balance) {
            const formattedBalance = new Intl.NumberFormat('vi-VN').format(balance) + ' VNƒê';
            
            // Update all balance displays
            const userBalanceEl = document.getElementById('userBalance');
            const profileBalanceEl = document.getElementById('profileBalance');
            const modalBalanceEl = document.getElementById('currentBalanceInModal');
            const mobileBalanceEl = document.getElementById('mobileUserBalance');
            
            if (userBalanceEl) userBalanceEl.textContent = formattedBalance;
            if (profileBalanceEl) profileBalanceEl.textContent = formattedBalance;
            if (modalBalanceEl) modalBalanceEl.textContent = formattedBalance;
            if (mobileBalanceEl) mobileBalanceEl.textContent = formattedBalance;
            
            console.log('Balance display updated:', formattedBalance);
        }

        async function loadTransactionHistory() {
            if (!currentUser) {
                console.log('No current user for transaction history');
                return;
            }

            console.log('Loading transaction history for:', currentUser.uid);

            try {
                const container = document.getElementById('transactionHistory');
                
                // Show loading state
                container.innerHTML = `
                    <div class="text-center text-gray-400 py-8">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                        <p>ƒêang t·∫£i l·ªãch s·ª≠ giao d·ªãch...</p>
                    </div>
                `;

                // Load data directly without listeners first
                await updateTransactionDisplay();

                // Set up real-time listeners
                if (transactionListener) transactionListener();
                if (topupListener) topupListener();

                transactionListener = db.collection('transactions')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .limit(50)
                    .onSnapshot(async (snapshot) => {
                        console.log('Transactions updated:', snapshot.size, 'documents');
                        await updateTransactionDisplay();
                    }, (error) => {
                        console.error('Transaction listener error:', error);
                    });

                topupListener = db.collection('topupRequests')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .limit(50)
                    .onSnapshot(async (snapshot) => {
                        console.log('Topup requests updated:', snapshot.size, 'documents');
                        await updateTransactionDisplay();
                    }, (error) => {
                        console.error('Topup listener error:', error);
                    });

            } catch (error) {
                console.error('Error loading transaction history:', error);
                document.getElementById('transactionHistory').innerHTML = `
                    <div class="text-center text-red-400 py-8">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p>L·ªói t·∫£i l·ªãch s·ª≠ giao d·ªãch</p>
                        <button onclick="loadTransactionHistory()" class="mt-2 text-blue-400 hover:text-blue-300 underline">Th·ª≠ l·∫°i</button>
                    </div>
                `;
            }
        }

        function showTransactionTab(tabType) {
            currentTransactionTab = tabType;
            
            // Update tab styles
            document.querySelectorAll('.transaction-tab').forEach(tab => {
                tab.classList.remove('border-blue-600', 'text-blue-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            const activeTab = document.getElementById(tabType + 'Tab');
            activeTab.classList.remove('border-transparent', 'text-gray-500');
            activeTab.classList.add('border-blue-600', 'text-blue-600');
            
            // Update title
            const title = tabType === 'topup' ? 'L·ªãch s·ª≠ n·∫°p ti·ªÅn' : 'L·ªãch s·ª≠ mua h√†ng';
            document.getElementById('transactionTitle').textContent = title;
            
            // Reload transactions for current tab
            updateTransactionDisplay();
        }

        // Global transaction storage with localStorage persistence
        let userTransactions = {
            topup: [],
            purchase: []
        };

        // Load transactions from localStorage
        function loadTransactionsFromStorage() {
            if (!currentUser) return;
            
            const storageKey = `transactions_${currentUser.uid}`;
            const stored = localStorage.getItem(storageKey);
            
            if (stored) {
                try {
                    const parsedData = JSON.parse(stored);
                    userTransactions = {
                        topup: parsedData.topup || [],
                        purchase: parsedData.purchase || []
                    };
                    console.log('Loaded transactions from storage:', userTransactions);
                } catch (error) {
                    console.error('Error parsing stored transactions:', error);
                    userTransactions = { topup: [], purchase: [] };
                }
            }
        }

        // Save transactions to localStorage
        function saveTransactionsToStorage() {
            if (!currentUser) return;
            
            const storageKey = `transactions_${currentUser.uid}`;
            try {
                localStorage.setItem(storageKey, JSON.stringify(userTransactions));
                console.log('Saved transactions to storage');
            } catch (error) {
                console.error('Error saving transactions to storage:', error);
            }
        }

        async function updateTransactionDisplay() {
            if (!currentUser) return;

            const container = document.getElementById('transactionHistory');

            try {
                console.log('Displaying transactions for tab:', currentTransactionTab);
                
                // Load from storage first
                loadTransactionsFromStorage();
                
                // Get transactions for current tab
                const transactions = userTransactions[currentTransactionTab] || [];
                
                console.log('Transactions to display:', transactions.length);
                
                if (transactions.length === 0) {
                    const emptyMessage = currentTransactionTab === 'topup' ? 'Ch∆∞a c√≥ giao d·ªãch n·∫°p ti·ªÅn n√†o' : 'Ch∆∞a c√≥ giao d·ªãch mua h√†ng n√†o';
                    container.innerHTML = `
                        <div class="text-center text-gray-400 py-8">
                            <i class="fas fa-receipt text-4xl mb-4 opacity-50"></i>
                            <p>${emptyMessage}</p>
                        </div>
                    `;
                    return;
                }

                // Sort by creation time (newest first)
                const sortedTransactions = [...transactions].sort((a, b) => {
                    const timeA = a.createdAt ? (a.createdAt.toDate ? a.createdAt.toDate() : new Date(a.createdAt)) : new Date(0);
                    const timeB = b.createdAt ? (b.createdAt.toDate ? b.createdAt.toDate() : new Date(b.createdAt)) : new Date(0);
                    return timeB - timeA;
                });

                container.innerHTML = sortedTransactions.map(transaction => {
                    const date = transaction.createdAt ? 
                        (transaction.createdAt.toDate ? 
                            new Date(transaction.createdAt.toDate()).toLocaleString('vi-VN') :
                            new Date(transaction.createdAt).toLocaleString('vi-VN')
                        ) : new Date().toLocaleString('vi-VN');
                    const amount = new Intl.NumberFormat('vi-VN').format(transaction.amount || 0);
                    
                    let icon, color, typeText, statusColor, statusText;
                    
                    if (transaction.type === 'topup') {
                        icon = 'fas fa-plus-circle';
                        color = 'text-green-400';
                        typeText = 'N·∫°p ti·ªÅn';
                    } else if (transaction.type === 'purchase') {
                        icon = 'fas fa-shopping-cart';
                        color = 'text-blue-400';
                        typeText = 'Mua game';
                    } else {
                        icon = 'fas fa-exchange-alt';
                        color = 'text-gray-400';
                        typeText = 'Giao d·ªãch';
                    }
                    
                    // Determine status color
                    switch(transaction.status) {
                        case 'completed':
                            statusColor = 'text-green-300 bg-green-600 bg-opacity-20';
                            statusText = 'Th√†nh c√¥ng';
                            break;
                        case 'pending':
                            statusColor = 'text-orange-300 bg-orange-600 bg-opacity-20';
                            statusText = 'ƒêang x·ª≠ l√Ω';
                            break;
                        case 'failed':
                            statusColor = 'text-red-300 bg-red-600 bg-opacity-20';
                            statusText = 'Th·∫•t b·∫°i';
                            break;
                        default:
                            statusColor = 'text-gray-300 bg-gray-600 bg-opacity-20';
                            statusText = 'Ho√†n th√†nh';
                    }

                    // Add click handler for purchase transactions
                    const clickHandler = transaction.type === 'purchase' ? 
                        `onclick="showPurchaseDetails('${transaction.id}')"` : '';

                    return `
                        <div class="transaction-item flex items-center justify-between p-4 border border-gray-600 rounded-lg ${transaction.type === 'purchase' ? 'cursor-pointer hover:bg-gray-800' : ''}" ${clickHandler}>
                            <div class="flex items-center">
                                <div class="w-10 h-10 ${color} bg-gray-700 rounded-full flex items-center justify-center mr-4">
                                    <i class="${icon}"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-white">${typeText}</p>
                                    <p class="text-sm text-gray-400">${date}</p>
                                    ${transaction.items ? `<p class="text-xs text-gray-500">${transaction.items.join(', ')}</p>` : ''}
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold ${color}">${transaction.type === 'purchase' ? '-' : '+'}${amount} VNƒê</p>
                                <span class="text-xs px-2 py-1 rounded-full ${statusColor}">${statusText}</span>
                                ${transaction.type === 'purchase' ? '<p class="text-xs text-blue-400 mt-1">Nh·∫•n ƒë·ªÉ xem chi ti·∫øt</p>' : ''}
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error updating transaction display:', error);
                container.innerHTML = `
                    <div class="text-center text-red-400 py-8">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p>L·ªói t·∫£i l·ªãch s·ª≠ giao d·ªãch</p>
                        <button onclick="loadTransactionHistory()" class="mt-2 text-blue-400 hover:text-blue-300 underline">Th·ª≠ l·∫°i</button>
                    </div>
                `;
            }
        }

        // Function to add transaction to local storage
        function addTransaction(transaction) {
            if (!userTransactions[transaction.type]) {
                userTransactions[transaction.type] = [];
            }
            
            // Check if transaction already exists
            const exists = userTransactions[transaction.type].find(t => t.id === transaction.id);
            if (!exists) {
                userTransactions[transaction.type].push(transaction);
                console.log('Added transaction:', transaction.type, transaction.id);
                
                // Save to localStorage immediately
                saveTransactionsToStorage();
                
                // Update display if we're on the right tab
                if (currentTransactionTab === transaction.type) {
                    updateTransactionDisplay();
                }
            }
        }

        // Carousel variables
        let currentSlide = 0;
        let carouselInterval;
        let carouselGames = [];

        // Game functions
        function loadSampleGames() {
            games = [
                {
                    id: '1',
                    name: 'ETS2 - mod "map Vi·ªát Nam"',
                    originalPrice: 500000,
                    price: 350000,
                    category: 'simulation',
                    description: 'Full 4 pack map Vi·ªát Nam + t·∫∑ng mod ti·ªÅn & kinh nghi·ªám + video h∆∞·ªõng d·∫´n c√†i ƒë·∫∑t chi ti·∫øt.',
                    image: 'üöõ',
                    key: 'ETS2-VN-MAP-XXXX'
                },
                {
                    id: '2',
                    name: 'ETS2 - mod "xe kh√°ch"',
                    originalPrice: 350000,
                    price: 150000,
                    category: 'simulation',
                    description: 'Video h∆∞·ªõng d·∫´n + t·∫∑ng xe kh√°ch Thaco 2017 + mod ƒë·ªông c∆° (tr·ªã gi√° 150.000 VNƒê).',
                    image: 'üöå',
                    key: 'ETS2-BUS-XXXX'
                },
                {
                    id: '3',
                    name: 'ETS2 - mod "ph·ª• ki·ªán"',
                    originalPrice: 200000,
                    price: 50000,
                    category: 'simulation',
                    description: 'G√≥i ph·ª• ki·ªán cho ETS2.',
                    image: 'üîß',
                    key: 'ETS2-ACCESSORIES-XXXX'
                },
                {
                    id: '4',
                    name: 'ETS2 - mod "xe t·∫£i Hino"',
                    originalPrice: 450000,
                    price: 99000,
                    category: 'simulation',
                    description: 'Mod xe t·∫£i Hino cho ETS2.',
                    image: 'üöö',
                    key: 'ETS2-HINO-XXXX'
                },
                {
                    id: '5',
                    name: 'Hack Li√™n Qu√¢n',
                    originalPrice: 400000,
                    price: 199000,
                    category: 'moba',
                    description: 'Hack map soi s√°ng full map, cam xa, hi·ªán unit, Antiband VIP, hi·ªán th·ªùi gian c√°c lo·∫°i, hi·ªán rank ƒë·ªãch. L∆∞u √Ω: kh√¥ng khuy·∫øn c√°o ch∆°i l·ªô; test tr√™n clone tr∆∞·ªõc v√†i tr·∫≠n.',
                    image: '‚öîÔ∏è',
                    key: 'AOV-HACK-XXXX'
                },
                {
                    id: '6',
                    name: 'Coin Master - T√≠nh nƒÉng hack',
                    originalPrice: 170000,
                    price: 50000,
                    category: 'casual',
                    description: 'IGG gi·ªØ v√†o b·∫≠t speed, skip ADS (n·∫øu c√≥). H∆∞·ªõng d·∫´n b·∫≠t 4G + VPN ƒë·ªÉ d·ªÖ t√¨m invite.',
                    image: 'ü™ô',
                    key: 'COINMASTER-HACK-XXXX'
                },
                {
                    id: '7',
                    name: 'SimCity BuildIt - T√≠nh nƒÉng hack',
                    originalPrice: 120000,
                    price: 10000,
                    category: 'simulation',
                    description: 'Hack mua ph·ª• ki·ªán t·ª± ƒë·ªông c·ªông v√†ng (v√≠ d·ª•: mua nh√† t·ªën 100 v√†ng th√¨ t·ª± c·ªông +100 v√†ng).',
                    image: 'üèôÔ∏è',
                    key: 'SIMCITY-HACK-XXXX'
                },
                {
                    id: '8',
                    name: 'MineCraft Mobile iOS ‚Äî B·∫£n free',
                    originalPrice: 200000,
                    price: 0,
                    category: 'sandbox',
                    description: 'B·∫£n free (t·∫£i mi·ªÖn ph√≠ trong file).',
                    image: '‚õèÔ∏è',
                    key: 'MINECRAFT-FREE-XXXX'
                },
                {
                    id: '9',
                    name: 'Li√™n Minh T·ªëc Chi·∫øn ‚Äî Hack',
                    originalPrice: 348000,
                    price: 277000,
                    category: 'moba',
                    description: 'Hack LMHTT (li√™n h·ªá admin ƒë·ªÉ thu√™). Gi√° thu√™: 30 ng√†y.',
                    image: 'üéÆ',
                    key: 'WILDRIFT-HACK-XXXX'
                },
                {
                    id: '10',
                    name: 'Tool LMHT',
                    originalPrice: 650000,
                    price: 450000,
                    category: 'moba',
                    description: 'Tool d√†nh cho LMHT. Gi√° thu√™: 30 ng√†y.',
                    image: 'üõ†Ô∏è',
                    key: 'LOL-TOOL-XXXX'
                },
                {
                    id: '11',
                    name: 'Hack PUBG MOBILE',
                    originalPrice: 550000,
                    price: 310000,
                    category: 'battle-royale',
                    description: 'H∆∞·ªõng d·∫´n v√† h·ªó tr·ª£ c√†i hack (li√™n h·ªá admin). Gi√° thu√™: 30 ng√†y.',
                    image: 'üî´',
                    key: 'PUBG-HACK-XXXX'
                },
                {
                    id: '12',
                    name: 'Facebook Clone (acc test hack PUBG)',
                    originalPrice: 17000,
                    price: 5000,
                    category: 'utility',
                    description: 'T√†i kho·∫£n test (clone).',
                    image: 'üì±',
                    key: 'FB-CLONE-XXXX'
                },
                {
                    id: '13',
                    name: 'Dragon City ‚Äî Hack',
                    originalPrice: 0,
                    price: 0,
                    category: 'casual',
                    description: 'B·∫•t t·ª≠, One hit, t·ª± ƒë·ªông ƒë√°nh, ƒë·ªãch ƒë√≥ng bƒÉng. Mi·ªÖn ph√≠.',
                    image: 'üêâ',
                    key: 'DRAGON-CITY-FREE'
                },
                {
                    id: '14',
                    name: 'Shooter Pool ‚Äî Cho thu√™ acc (1 gi·ªù)',
                    originalPrice: 35000,
                    price: 35000,
                    category: 'sports',
                    description: 'Cho thu√™ theo gi·ªù.',
                    image: 'üé±',
                    key: 'POOL-1H-XXXX'
                },
                {
                    id: '15',
                    name: 'Shooter Pool ‚Äî Cho thu√™ acc (5 gi·ªù)',
                    originalPrice: 100000,
                    price: 100000,
                    category: 'sports',
                    description: 'Cho thu√™ 5 gi·ªù.',
                    image: 'üé±',
                    key: 'POOL-5H-XXXX'
                },
                {
                    id: '16',
                    name: 'Shooter Pool ‚Äî Cho thu√™ acc (24 gi·ªù)',
                    originalPrice: 200000,
                    price: 200000,
                    category: 'sports',
                    description: 'Cho thu√™ 24 gi·ªù.',
                    image: 'üé±',
                    key: 'POOL-24H-XXXX'
                }
            ];
            
            carouselGames = games.slice(0, 4); // Take first 4 games for carousel
            displayGames();
            initializeCarousel();
        }

        function displayGames(gamesToShow = games) {
            const allGamesContainer = document.getElementById('allGames');
            const gameHTML = gamesToShow.map(game => createGameCard(game)).join('');
            allGamesContainer.innerHTML = gameHTML;
        }

        function initializeCarousel() {
            const carouselContainer = document.getElementById('featuredCarousel');
            const dotsContainer = document.getElementById('carouselDots');
            
            // Create carousel slides
            carouselContainer.innerHTML = carouselGames.map(game => createCarouselSlide(game)).join('');
            
            // Create dots
            dotsContainer.innerHTML = carouselGames.map((_, index) => 
                `<button class="carousel-dot w-3 h-3 rounded-full transition-all ${index === 0 ? 'bg-blue-600' : 'bg-gray-300'}" onclick="goToSlide(${index})"></button>`
            ).join('');
            
            // Setup navigation
            document.getElementById('prevBtn').onclick = () => previousSlide();
            document.getElementById('nextBtn').onclick = () => nextSlide();
            
            // Start auto-slide
            startAutoSlide();
            
            // Pause on hover
            const carouselWrapper = carouselContainer.parentElement.parentElement;
            carouselWrapper.addEventListener('mouseenter', stopAutoSlide);
            carouselWrapper.addEventListener('mouseleave', startAutoSlide);
        }

        function createCarouselSlide(game) {
            const formattedPrice = new Intl.NumberFormat('vi-VN').format(game.price);
            const formattedOriginalPrice = game.originalPrice ? new Intl.NumberFormat('vi-VN').format(game.originalPrice) : null;
            
            return `
                <div class="carousel-slide min-w-full bg-gradient-to-br from-purple-600 to-blue-600 text-white p-8 flex items-center">
                    <div class="flex-1">
                        <div class="text-6xl mb-4">${game.image}</div>
                        <h3 class="text-3xl font-bold mb-4">${game.name}</h3>
                        <p class="text-lg mb-6 opacity-90">${game.description}</p>
                        <div class="flex items-center gap-4">
                            <div class="flex flex-col">
                                ${formattedOriginalPrice ? `<span class="text-lg line-through opacity-60">${formattedOriginalPrice} VNƒê</span>` : ''}
                                <span class="text-2xl font-bold bg-white bg-opacity-20 px-4 py-2 rounded-lg">${formattedPrice} VNƒê</span>
                                ${formattedOriginalPrice ? '<span class="text-sm bg-red-500 px-2 py-1 rounded-full mt-1">-40%</span>' : ''}
                            </div>
                            <button onclick="addToCart('${game.id}')" class="bg-white text-blue-600 px-6 py-3 rounded-lg hover:bg-blue-50 transition-colors font-semibold">
                                <i class="fas fa-cart-plus mr-2"></i>Th√™m v√†o gi·ªè
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function goToSlide(index) {
            currentSlide = index;
            updateCarousel();
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % carouselGames.length;
            updateCarousel();
        }

        function previousSlide() {
            currentSlide = (currentSlide - 1 + carouselGames.length) % carouselGames.length;
            updateCarousel();
        }

        function updateCarousel() {
            const carouselContainer = document.getElementById('featuredCarousel');
            const dots = document.querySelectorAll('.carousel-dot');
            
            carouselContainer.style.transform = `translateX(-${currentSlide * 100}%)`;
            
            dots.forEach((dot, index) => {
                dot.classList.toggle('bg-blue-600', index === currentSlide);
                dot.classList.toggle('bg-gray-300', index !== currentSlide);
            });
        }

        function startAutoSlide() {
            stopAutoSlide();
            carouselInterval = setInterval(() => {
                nextSlide();
            }, 4000);
        }

        function stopAutoSlide() {
            if (carouselInterval) {
                clearInterval(carouselInterval);
                carouselInterval = null;
            }
        }

        function createGameCard(game) {
            const formattedPrice = new Intl.NumberFormat('vi-VN').format(game.price);
            const formattedOriginalPrice = game.originalPrice ? new Intl.NumberFormat('vi-VN').format(game.originalPrice) : null;
            
            return `
                <div class="game-card bg-white rounded-lg shadow-md overflow-hidden relative">
                    ${formattedOriginalPrice ? '<div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold z-10">-40%</div>' : ''}
                    <div class="h-48 bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-6xl">
                        ${game.image}
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-semibold mb-2">${game.name}</h3>
                        <p class="text-gray-600 mb-4 text-sm">${game.description}</p>
                        <div class="mb-4">
                            ${formattedOriginalPrice ? `<div class="text-sm text-gray-500 line-through">${formattedOriginalPrice} VNƒê</div>` : ''}
                            <div class="text-2xl font-bold text-blue-600">${formattedPrice} VNƒê</div>
                        </div>
                        
                        <div class="flex gap-2">
                            <button onclick="addToCart('${game.id}')" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-cart-plus mr-1"></i>Th√™m
                            </button>
                            <button onclick="buyNow('${game.id}')" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-shopping-bag mr-1"></i>Mua
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function filterGames() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            const priceRange = document.getElementById('priceFilter').value;
            
            const filteredGames = games.filter(game => {
                const matchesSearch = game.name.toLowerCase().includes(searchTerm) || 
                                    game.description.toLowerCase().includes(searchTerm);
                const matchesCategory = !category || game.category === category;
                
                let matchesPrice = true;
                if (priceRange) {
                    const [minPrice, maxPrice] = priceRange.split('-').map(Number);
                    matchesPrice = game.price >= minPrice && game.price <= maxPrice;
                }
                
                return matchesSearch && matchesCategory && matchesPrice;
            });
            
            displayGames(filteredGames);
        }

        // Cart functions
        function addToCart(gameId) {
            if (!currentUser) {
                showNotification('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m v√†o gi·ªè h√†ng!', 'error');
                showLogin();
                return;
            }

            const game = games.find(g => g.id === gameId);
            if (game) {
                const existingItem = cart.find(item => item.id === gameId);
                if (existingItem) {
                    showNotification('Game ƒë√£ c√≥ trong gi·ªè h√†ng!', 'error');
                } else {
                    cart.push(game);
                    updateCartDisplay();
                    showNotification('ƒê√£ th√™m v√†o gi·ªè h√†ng!', 'success');
                }
            }
        }

        function buyNow(gameId) {
            if (!currentUser) {
                showNotification('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ mua game!', 'error');
                showLogin();
                return;
            }

            const game = games.find(g => g.id === gameId);
            if (game) {
                // Clear cart and add only this game
                cart = [game];
                updateCartDisplay();
                // Automatically open cart and proceed to checkout
                showCart();
                showNotification('Game ƒë√£ ƒë∆∞·ª£c th√™m v√†o gi·ªè h√†ng. Ti·∫øn h√†nh thanh to√°n!', 'success');
            }
        }

        function removeFromCart(gameId) {
            cart = cart.filter(item => item.id !== gameId);
            updateCartDisplay();
            displayCartItems();
        }

        function updateCartDisplay() {
            const count = cart.length;
            document.getElementById('cartCount').textContent = count;
            document.getElementById('mobileCartCount').textContent = count;
        }

        function showCart() {
            if (!currentUser) {
                showNotification('Vui l√≤ng ƒëƒÉng nh·∫≠p!', 'error');
                showLogin();
                return;
            }
            
            displayCartItems();
            showModal('cartModal');
        }

        function displayCartItems() {
            const cartContainer = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            
            if (cart.length === 0) {
                cartContainer.innerHTML = '<p class="text-center text-gray-500">Gi·ªè h√†ng tr·ªëng</p>';
                cartTotal.textContent = '0 VNƒê';
                return;
            }
            
            const total = cart.reduce((sum, game) => sum + game.price, 0);
            cartTotal.textContent = new Intl.NumberFormat('vi-VN').format(total) + ' VNƒê';
            
            cartContainer.innerHTML = cart.map(game => `
                <div class="flex justify-between items-center p-4 border border-gray-200 rounded-lg">
                    <div class="flex items-center">
                        <span class="text-2xl mr-3">${game.image}</span>
                        <div>
                            <h4 class="font-semibold">${game.name}</h4>
                            <p class="text-blue-600 font-semibold">${new Intl.NumberFormat('vi-VN').format(game.price)} VNƒê</p>
                        </div>
                    </div>
                    <button onclick="removeFromCart('${game.id}')" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        async function checkout() {
            if (!currentUser || cart.length === 0) return;
            
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                
                // Calculate total with applied vouchers
                let total = 0;
                const usedVouchers = [];
                
                cart.forEach(game => {
                    if (game.appliedVoucher) {
                        total += game.discountedPrice || game.price;
                        usedVouchers.push(game.appliedVoucher);
                    } else {
                        total += game.price;
                    }
                });
                
                if (userData.balance < total) {
                    showNotification('S·ªë d∆∞ kh√¥ng ƒë·ªß! Vui l√≤ng n·∫°p th√™m ti·ªÅn.', 'error');
                    return;
                }
                
                // Generate game accounts for each purchased game
                const gameAccounts = cart.map(game => ({
                    gameId: game.id,
                    gameName: game.name,
                    username: generateGameUsername(game.name),
                    password: generateGamePassword(),
                    notes: `T√†i kho·∫£n game ${game.name} - ƒê√£ k√≠ch ho·∫°t v√† s·∫µn s√†ng s·ª≠ d·ª•ng. Vui l√≤ng ƒë·ªïi m·∫≠t kh·∫©u sau khi ƒëƒÉng nh·∫≠p l·∫ßn ƒë·∫ßu.`
                }));
                
                // Generate unique transaction ID
                const transactionId = 'txn_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                // Create transaction object
                const transaction = {
                    id: transactionId,
                    userId: currentUser.uid,
                    type: 'purchase',
                    amount: total,
                    status: 'completed',
                    items: cart.map(item => item.name),
                    gameAccounts: gameAccounts,
                    createdAt: new Date()
                };
                
                // Add to local storage immediately
                addTransaction(transaction);

                // Check purchase mission
                checkPurchaseMission();
                
                // Try to save to Firestore (but don't block if it fails)
                try {
                    // Create order with game accounts
                    const order = {
                        userId: currentUser.uid,
                        items: cart,
                        gameAccounts: gameAccounts,
                        total: total,
                        status: 'completed',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    const orderRef = await db.collection('orders').add(order);
                    
                    // Update user balance
                    await db.collection('users').doc(currentUser.uid).update({
                        balance: userData.balance - total
                    });
                    
                    // Add transaction record with order reference
                    await db.collection('transactions').add({
                        ...transaction,
                        orderId: orderRef.id,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    console.log('Transaction saved to Firestore:', orderRef.id);
                } catch (firestoreError) {
                    console.error('Firestore save failed, but transaction is saved locally:', firestoreError);
                }
                
                // Mark used vouchers as used
                usedVouchers.forEach(voucher => {
                    const userVoucher = userVouchers.find(v => v.id === voucher.id);
                    if (userVoucher) {
                        userVoucher.used = true;
                    }
                });
                
                if (usedVouchers.length > 0) {
                    saveUserVouchers();
                    updateVouchersDisplay();
                }
                
                cart = [];
                updateCartDisplay();
                closeModal('cartModal');
                
                showNotification('Mua h√†ng th√†nh c√¥ng! Ki·ªÉm tra l·ªãch s·ª≠ giao d·ªãch ƒë·ªÉ xem th√¥ng tin t√†i kho·∫£n.', 'success');
                
                // Auto show purchase details
                setTimeout(() => {
                    showPurchaseDetails(transactionId);
                }, 1000);
                
            } catch (error) {
                console.error('Checkout error:', error);
                showNotification('L·ªói thanh to√°n: ' + error.message, 'error');
            }
        }

        // Helper functions to generate game accounts
        function generateGameUsername(gameName) {
            const prefix = gameName.toLowerCase().replace(/[^a-z0-9]/g, '').substring(0, 4);
            const randomNum = Math.floor(Math.random() * 9999).toString().padStart(4, '0');
            return `${prefix}${randomNum}`;
        }

        function generateGamePassword() {
            const chars = 'ABCDEFGHJKMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789';
            let password = '';
            for (let i = 0; i < 12; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return password;
        }

        // Topup functions
        function selectAmount(amount) {
            document.getElementById('topupAmount').value = amount;
            
            // Update button styles
            document.querySelectorAll('.amount-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        // Global variables for topup
        let currentTopupAmount = 0;

        async function handleTopup(e) {
            e.preventDefault();
            const amount = parseInt(document.getElementById('topupAmount').value);
            
            if (!amount || amount < 10000) {
                showNotification('S·ªë ti·ªÅn n·∫°p t·ªëi thi·ªÉu l√† 10,000 VNƒê!', 'error');
                return;
            }

            currentTopupAmount = amount;
            
            // Show step 2 with bank info
            document.getElementById('topupStep1').classList.add('hidden');
            document.getElementById('topupStep2').classList.remove('hidden');
            
            // Update transfer info
            document.getElementById('transferAmount').textContent = new Intl.NumberFormat('vi-VN').format(amount) + ' VNƒê';
            document.getElementById('transferContent').textContent = currentUser.email;
        }

        function backToStep1() {
            document.getElementById('topupStep2').classList.add('hidden');
            document.getElementById('topupStep1').classList.remove('hidden');
        }

        async function confirmTopup() {
            if (!currentTopupAmount) return;
            
            try {
                console.log('Creating topup request for user:', currentUser.uid, 'amount:', currentTopupAmount);
                
                // Generate unique transaction ID
                const transactionId = 'topup_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                // Create pending transaction immediately
                const pendingTransaction = {
                    id: transactionId,
                    userId: currentUser.uid,
                    type: 'topup',
                    amount: currentTopupAmount,
                    status: 'pending',
                    createdAt: new Date()
                };
                
                // Add to local storage immediately
                addTransaction(pendingTransaction);
                
                // Try to create topup request in Firestore
                try {
                    const topupRequestRef = await db.collection('topupRequests').add({
                        userId: currentUser.uid,
                        email: currentUser.email,
                        amount: currentTopupAmount,
                        status: 'pending',
                        processed: false,
                        transactionId: transactionId,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    console.log('Topup request created:', topupRequestRef.id);

                    // Listen for status changes on this specific request
                    const unsubscribe = db.collection('topupRequests').doc(topupRequestRef.id)
                        .onSnapshot(async (doc) => {
                            if (doc.exists) {
                                const requestData = doc.data();
                                console.log('Topup request status:', requestData.status, 'processed:', requestData.processed);
                                
                                // If admin approved (status = completed) and not yet processed
                                if (requestData.status === 'completed' && !requestData.processed) {
                                    try {
                                        console.log('Processing topup request...');
                                        
                                        // Update transaction status to completed
                                        const completedTransaction = {
                                            ...pendingTransaction,
                                            status: 'completed',
                                            processedAt: new Date()
                                        };
                                        
                                        // Update in local storage
                                        const topupTransactions = userTransactions.topup || [];
                                        const index = topupTransactions.findIndex(t => t.id === transactionId);
                                        if (index !== -1) {
                                            userTransactions.topup[index] = completedTransaction;
                                        }
                                        
                                        // Get current user balance
                                        const userDoc = await db.collection('users').doc(currentUser.uid).get();
                                        const userData = userDoc.data();
                                        const currentBalance = userData.balance || 0;
                                        
                                        console.log('Current balance:', currentBalance, 'Adding:', requestData.amount);
                                        
                                        // Add money to account
                                        await db.collection('users').doc(currentUser.uid).update({
                                            balance: currentBalance + requestData.amount
                                        });
                                        
                                        // Create completed transaction in Firestore
                                        await db.collection('transactions').add({
                                            ...completedTransaction,
                                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                                        });
                                        
                                        // Mark as processed to avoid duplicate processing
                                        await db.collection('topupRequests').doc(topupRequestRef.id).update({
                                            processed: true
                                        });
                                        
                                        console.log('Topup processed successfully');
                                        showNotification('N·∫°p ti·ªÅn th√†nh c√¥ng! S·ªë d∆∞ ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t.', 'success');

                                        // Check topup mission
                                        checkTopupMission(requestData.amount);
                                        
                                        // Update display if on topup tab
                                        if (currentTransactionTab === 'topup') {
                                            updateTransactionDisplay();
                                        }
                                        
                                        unsubscribe(); // Stop listening
                                    } catch (error) {
                                        console.error('Error processing topup:', error);
                                        showNotification('L·ªói x·ª≠ l√Ω n·∫°p ti·ªÅn: ' + error.message, 'error');
                                    }
                                }
                            }
                        }, (error) => {
                            console.error('Error listening to topup request:', error);
                        });
                } catch (firestoreError) {
                    console.error('Firestore topup request failed, but transaction is saved locally:', firestoreError);
                }
                
                closeModal('topupModal');
                showNotification('Y√™u c·∫ßu n·∫°p ti·ªÅn ƒë√£ ƒë∆∞·ª£c g·ª≠i! Vui l√≤ng chuy·ªÉn kho·∫£n theo th√¥ng tin ƒë√£ cung c·∫•p.', 'success');
                
                // Reset form and steps
                document.getElementById('topupForm').reset();
                document.getElementById('topupStep2').classList.add('hidden');
                document.getElementById('topupStep1').classList.remove('hidden');
                currentTopupAmount = 0;
                
                // Reset amount buttons
                document.querySelectorAll('.amount-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
            } catch (error) {
                console.error('Error creating topup request:', error);
                showNotification('L·ªói g·ª≠i y√™u c·∫ßu n·∫°p ti·ªÅn: ' + error.message, 'error');
            }
        }

        // Purchase details function
        async function showPurchaseDetails(transactionId) {
            try {
                console.log('Showing purchase details for:', transactionId);
                
                // For sample transactions, show sample data
                if (transactionId === 'sample2') {
                    const sampleGameAccounts = [
                        {
                            gameName: 'Cyberpunk 2077',
                            username: 'cyber2077',
                            password: 'GamePass123',
                            notes: 'T√†i kho·∫£n game Cyberpunk 2077 - ƒê√£ k√≠ch ho·∫°t v√† s·∫µn s√†ng s·ª≠ d·ª•ng. Vui l√≤ng ƒë·ªïi m·∫≠t kh·∫©u sau khi ƒëƒÉng nh·∫≠p l·∫ßn ƒë·∫ßu.'
                        }
                    ];
                    displayPurchaseDetails(sampleGameAccounts, 'sample2');
                    return;
                }
                
                // Try to get real order data
                let gameAccounts = [];
                
                try {
                    // First try to get from orders collection
                    const orderDoc = await db.collection('orders').doc(transactionId).get();
                    if (orderDoc.exists) {
                        const orderData = orderDoc.data();
                        gameAccounts = orderData.gameAccounts || [];
                    } else {
                        // Try to get from transactions collection
                        const transactionDoc = await db.collection('transactions').doc(transactionId).get();
                        if (transactionDoc.exists) {
                            const transactionData = transactionDoc.data();
                            gameAccounts = transactionData.gameAccounts || [];
                            
                            // If no game accounts in transaction, try to get from order
                            if (gameAccounts.length === 0 && transactionData.orderId) {
                                const orderDoc = await db.collection('orders').doc(transactionData.orderId).get();
                                if (orderDoc.exists) {
                                    const orderData = orderDoc.data();
                                    gameAccounts = orderData.gameAccounts || [];
                                }
                            }
                        }
                    }
                } catch (error) {
                    console.error('Error fetching purchase details:', error);
                }
                
                // If no real data found, generate sample data
                if (gameAccounts.length === 0) {
                    gameAccounts = [
                        {
                            gameName: 'Game ƒë√£ mua',
                            username: 'demo' + Math.floor(Math.random() * 1000),
                            password: 'DemoPass' + Math.floor(Math.random() * 1000),
                            notes: 'ƒê√¢y l√† t√†i kho·∫£n demo. Trong th·ª±c t·∫ø, ƒë√¢y s·∫Ω l√† th√¥ng tin t√†i kho·∫£n game th·∫≠t.'
                        }
                    ];
                }
                
                displayPurchaseDetails(gameAccounts, transactionId);
                
            } catch (error) {
                console.error('Error showing purchase details:', error);
                showNotification('L·ªói t·∫£i th√¥ng tin ƒë∆°n h√†ng', 'error');
            }
        }

        function displayPurchaseDetails(gameAccounts, transactionId) {
            const content = document.getElementById('purchaseDetailsContent');
            
            content.innerHTML = gameAccounts.map((account, index) => `
                <div class="bg-gray-800 border border-gray-600 rounded-lg p-6 space-y-4">
                    <div class="flex items-center justify-between border-b border-gray-600 pb-3">
                        <h3 class="text-lg font-bold text-white flex items-center">
                            <i class="fas fa-gamepad text-blue-400 mr-2"></i>
                            ${account.gameName}
                        </h3>
                        <span class="text-xs bg-green-600 bg-opacity-20 text-green-300 px-2 py-1 rounded-full">
                            ƒê√£ k√≠ch ho·∫°t
                        </span>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-700 rounded-lg p-4">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-xs text-gray-400 mb-1">T√™n ƒëƒÉng nh·∫≠p</p>
                                    <p class="font-mono text-white font-semibold">${account.username}</p>
                                </div>
                                <button onclick="copyToClipboard('${account.username}')" class="copy-btn px-3 py-2 rounded-lg text-xs">
                                    <i class="fas fa-copy mr-1"></i>Copy
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-gray-700 rounded-lg p-4">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-xs text-gray-400 mb-1">M·∫≠t kh·∫©u</p>
                                    <p class="font-mono text-white font-semibold">${account.password}</p>
                                </div>
                                <button onclick="copyToClipboard('${account.password}')" class="copy-btn px-3 py-2 rounded-lg text-xs">
                                    <i class="fas fa-copy mr-1"></i>Copy
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-600 bg-opacity-20 border border-blue-500 rounded-lg p-4">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-blue-400 mt-0.5 mr-2"></i>
                            <div class="text-sm text-blue-200">
                                <p class="font-medium mb-1">üìù Ghi ch√∫ quan tr·ªçng:</p>
                                <p>${account.notes}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Add general instructions
            content.innerHTML += `
                <div class="bg-amber-600 bg-opacity-20 border border-amber-500 rounded-lg p-4 mt-4">
                    <div class="flex items-start">
                        <i class="fas fa-exclamation-triangle text-amber-400 mt-0.5 mr-2"></i>
                        <div class="text-sm text-amber-200">
                            <p class="font-medium mb-2">‚ö†Ô∏è L∆∞u √Ω b·∫£o m·∫≠t:</p>
                            <ul class="list-disc list-inside space-y-1">
                                <li>Vui l√≤ng ƒë·ªïi m·∫≠t kh·∫©u ngay sau khi ƒëƒÉng nh·∫≠p l·∫ßn ƒë·∫ßu</li>
                                <li>Kh√¥ng chia s·∫ª th√¥ng tin t√†i kho·∫£n v·ªõi ng∆∞·ªùi kh√°c</li>
                                <li>L∆∞u tr·ªØ th√¥ng tin t√†i kho·∫£n ·ªü n∆°i an to√†n</li>
                                <li>Li√™n h·ªá h·ªó tr·ª£ n·∫øu g·∫∑p v·∫•n ƒë·ªÅ v·ªõi t√†i kho·∫£n</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            showModal('purchaseDetailsModal');
        }

        // Copy functions
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('ƒê√£ sao ch√©p: ' + text, 'success');
            }).catch(() => {
                showNotification('Kh√¥ng th·ªÉ sao ch√©p', 'error');
            });
        }

        function copyAmount() {
            const amount = document.getElementById('transferAmount').textContent.replace(' VNƒê', '').replace(/\./g, '');
            copyToClipboard(amount);
        }

        function copyContent() {
            const content = document.getElementById('transferContent').textContent;
            copyToClipboard(content);
        }

        // UI Helper functions
        function showSection(section) {
            document.querySelectorAll('.section').forEach(el => el.classList.add('hidden'));
            document.getElementById(section + 'Section').classList.remove('hidden');
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function showLogin() {
            showModal('loginModal');
        }

        function showRegister() {
            showModal('registerModal');
        }

        function showTopup() {
            showModal('topupModal');
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            // Clear any existing timeout
            if (window.notificationTimeout) {
                clearTimeout(window.notificationTimeout);
            }
            
            // Hide notification first if it's already showing
            notification.classList.remove('show');
            
            setTimeout(() => {
                notificationText.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');
                
                // Auto hide after 4 seconds
                window.notificationTimeout = setTimeout(() => {
                    notification.classList.remove('show');
                }, 4000);
            }, 100);
        }

        function closeWelcomeBanner() {
            document.getElementById('welcomeBanner').classList.remove('show');
            // Set a flag so it doesn't show again in this session
            sessionStorage.setItem('welcomeBannerShown', 'true');
        }

        // Auto-hide welcome banner after 10 seconds if user doesn't interact
        setTimeout(() => {
            if (!sessionStorage.getItem('welcomeBannerShown')) {
                closeWelcomeBanner();
            }
        }, 10000);

        // Snow Effect Functions
        function initSnowEffect() {
            createSnowflakes();
            
            // Create new snowflakes periodically
            setInterval(createSnowflake, 800);
        }

        function createSnowflakes() {
            // Create initial batch of snowflakes
            for (let i = 0; i < 15; i++) {
                setTimeout(() => createSnowflake(), i * 200);
            }
        }

        function createSnowflake() {
            const snowflake = document.createElement('div');
            const snowTypes = ['type-1', 'type-2', 'type-3', 'type-4', 'type-5', 'type-6'];
            const randomType = snowTypes[Math.floor(Math.random() * snowTypes.length)];
            
            snowflake.className = `snowflake ${randomType}`;
            
            // Random horizontal position
            snowflake.style.left = Math.random() * 100 + 'vw';
            
            // Random animation delay for more natural effect
            snowflake.style.animationDelay = Math.random() * 2 + 's';
            
            // Random horizontal drift
            const drift = (Math.random() - 0.5) * 100;
            snowflake.style.setProperty('--drift', drift + 'px');
            
            // Add subtle horizontal movement
            snowflake.style.animation = `snowfall ${12 + Math.random() * 8}s linear infinite`;
            
            document.body.appendChild(snowflake);
            
            // Remove snowflake after animation completes
            setTimeout(() => {
                if (snowflake.parentNode) {
                    snowflake.parentNode.removeChild(snowflake);
                }
            }, 25000);
        }





        // Tree Growing Game Functions
        let treeGame = {
            level: 1,
            currentExp: 0,
            totalExp: 0,
            achievements: [],
            freeWater: 0,
            freeFertilizer: 0,
            dailyMissions: {
                lastReset: null,
                loginReward: false,
                purchaseCount: 0,
                topupAmount: 0
            }
        };

        // Load tree game data from localStorage
        function loadTreeGameData() {
            if (!currentUser) return;
            
            const storageKey = `treeGame_${currentUser.uid}`;
            const stored = localStorage.getItem(storageKey);
            
            if (stored) {
                try {
                    const loadedData = JSON.parse(stored);
                    treeGame = {
                        level: loadedData.level || 1,
                        currentExp: loadedData.currentExp || 0,
                        totalExp: loadedData.totalExp || 0,
                        achievements: loadedData.achievements || [],
                        freeWater: loadedData.freeWater || 0,
                        freeFertilizer: loadedData.freeFertilizer || 0,
                        dailyMissions: loadedData.dailyMissions || {
                            lastReset: null,
                            loginReward: false,
                            purchaseCount: 0,
                            topupAmount: 0
                        }
                    };
                    console.log('Loaded tree game data:', treeGame);
                } catch (error) {
                    console.error('Error parsing stored tree game data:', error);
                    resetTreeGameData();
                }
            } else {
                resetTreeGameData();
            }
            
            checkDailyReset();
            updateTreeDisplay();
            updateDailyMissions();
        }

        function resetTreeGameData() {
            treeGame = {
                level: 1,
                currentExp: 0,
                totalExp: 0,
                achievements: [],
                freeWater: 0,
                freeFertilizer: 0,
                dailyMissions: {
                    lastReset: null,
                    loginReward: false,
                    purchaseCount: 0,
                    topupAmount: 0
                }
            };
        }

        // Save tree game data to localStorage
        function saveTreeGameData() {
            if (!currentUser) return;
            
            const storageKey = `treeGame_${currentUser.uid}`;
            try {
                localStorage.setItem(storageKey, JSON.stringify(treeGame));
                console.log('Saved tree game data');
            } catch (error) {
                console.error('Error saving tree game data:', error);
            }
        }

        // Calculate EXP needed for next level
        function getExpNeededForLevel(level) {
            return 47000 * Math.pow(2, level - 1);
        }

        // Get tree emoji based on level
        function getTreeEmoji(level) {
            if (level >= 80) return 'üå≥'; // Giant tree
            if (level >= 60) return 'üå≤'; // Big tree
            if (level >= 40) return 'üå¥'; // Palm tree
            if (level >= 20) return 'üåø'; // Bush
            if (level >= 10) return 'ü™¥'; // Potted plant
            if (level >= 5) return 'üå±'; // Seedling
            return 'üå±'; // Seedling
        }

        // Update tree display
        function updateTreeDisplay() {
            const treeDisplay = document.getElementById('treeDisplay');
            const treeLevelEl = document.getElementById('treeLevel');
            const totalExpEl = document.getElementById('totalExp');
            const expProgressEl = document.getElementById('expProgress');
            const expBarEl = document.getElementById('expBar');
            const levelUpSection = document.getElementById('levelUpSection');
            const nextRewardEl = document.getElementById('nextReward');
            const freeWaterCountEl = document.getElementById('freeWaterCount');
            const freeFertilizerCountEl = document.getElementById('freeFertilizerCount');
            const freeWaterBtn = document.getElementById('freeWaterBtn');
            const freeFertilizerBtn = document.getElementById('freeFertilizerBtn');

            if (!treeDisplay) return; // Elements not loaded yet

            // Update tree emoji
            treeDisplay.textContent = getTreeEmoji(treeGame.level);
            
            // Update level and total exp
            treeLevelEl.textContent = treeGame.level;
            totalExpEl.textContent = new Intl.NumberFormat('vi-VN').format(treeGame.totalExp);

            // Calculate progress for current level
            const expNeeded = getExpNeededForLevel(treeGame.level);
            const progressPercent = Math.min((treeGame.currentExp / expNeeded) * 100, 100);
            
            expProgressEl.textContent = `${new Intl.NumberFormat('vi-VN').format(treeGame.currentExp)} / ${new Intl.NumberFormat('vi-VN').format(expNeeded)}`;
            expBarEl.style.width = progressPercent + '%';

            // Show/hide level up button
            if (treeGame.currentExp >= expNeeded) {
                levelUpSection.classList.remove('hidden');
            } else {
                levelUpSection.classList.add('hidden');
            }

            // Update next reward info
            const nextRewardLevel = Math.ceil(treeGame.level / 5) * 5;
            const rewardMultiplier = Math.floor(nextRewardLevel / 5);
            const rewardAmount = 500000 * Math.pow(2, rewardMultiplier - 1);
            nextRewardEl.textContent = `C·∫•p ${nextRewardLevel}: ${new Intl.NumberFormat('vi-VN').format(rewardAmount)} VNƒê`;

            // Update free care counts
            if (freeWaterCountEl) freeWaterCountEl.textContent = treeGame.freeWater;
            if (freeFertilizerCountEl) freeFertilizerCountEl.textContent = treeGame.freeFertilizer;

            // Update button states
            if (freeWaterBtn) {
                freeWaterBtn.disabled = treeGame.freeWater <= 0;
            }
            if (freeFertilizerBtn) {
                freeFertilizerBtn.disabled = treeGame.freeFertilizer <= 0;
            }
        }

        // Care for tree (water/fertilize)
        async function careForTree(expGain, cost) {
            if (!currentUser) {
                showNotification('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ch∆°i game!', 'error');
                showLogin();
                return;
            }

            try {
                // Check user balance
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                const currentBalance = userData.balance || 0;

                if (currentBalance < cost) {
                    showNotification(`S·ªë d∆∞ kh√¥ng ƒë·ªß! C·∫ßn ${new Intl.NumberFormat('vi-VN').format(cost)} VNƒê.`, 'error');
                    return;
                }

                // Deduct cost
                await db.collection('users').doc(currentUser.uid).update({
                    balance: currentBalance - cost
                });

                // Add EXP
                treeGame.currentExp += expGain;
                treeGame.totalExp += expGain;

                // Save data
                saveTreeGameData();
                updateTreeDisplay();

                // Show notification
                const actionName = cost === 1000 ? 't∆∞·ªõi n∆∞·ªõc' : 'b√≥n ph√¢n';
                showNotification(`ƒê√£ ${actionName}! +${expGain} EXP`, 'success');

                // Add achievement
                addAchievement(`${actionName} cho c√¢y (+${expGain} EXP)`);

            } catch (error) {
                console.error('Error caring for tree:', error);
                showNotification('L·ªói chƒÉm s√≥c c√¢y: ' + error.message, 'error');
            }
        }

        // Attempt to level up
        async function attemptLevelUp() {
            const expNeeded = getExpNeededForLevel(treeGame.level);
            
            if (treeGame.currentExp < expNeeded) {
                showNotification('Ch∆∞a ƒë·ªß EXP ƒë·ªÉ n√¢ng c·∫•p!', 'error');
                return;
            }

            // 50% chance to succeed
            const success = Math.random() < 0.5;
            
            if (success) {
                // Level up success
                treeGame.level++;
                treeGame.currentExp = 0; // Reset current exp for new level
                
                // Check for reward
                if (treeGame.level % 5 === 0) {
                    await giveReward(treeGame.level);
                }
                
                showNotification(`üéâ N√¢ng c·∫•p th√†nh c√¥ng! C√¢y ƒë√£ l√™n c·∫•p ${treeGame.level}!`, 'success');
                addAchievement(`N√¢ng c·∫•p th√†nh c√¥ng l√™n c·∫•p ${treeGame.level}! üéâ`);
                
            } else {
                // Level up failed
                if (treeGame.level > 1) {
                    treeGame.level--;
                    treeGame.currentExp = 0; // Reset exp
                    showNotification(`üò¢ N√¢ng c·∫•p th·∫•t b·∫°i! C√¢y xu·ªëng c·∫•p ${treeGame.level}`, 'error');
                    addAchievement(`N√¢ng c·∫•p th·∫•t b·∫°i, xu·ªëng c·∫•p ${treeGame.level} üò¢`);
                } else {
                    treeGame.currentExp = 0; // Just reset exp if already level 1
                    showNotification('üò¢ N√¢ng c·∫•p th·∫•t b·∫°i! EXP ƒë√£ b·ªã reset', 'error');
                    addAchievement('N√¢ng c·∫•p th·∫•t b·∫°i, EXP b·ªã reset üò¢');
                }
            }
            
            saveTreeGameData();
            updateTreeDisplay();
        }

        // Give reward for reaching milestone levels
        async function giveReward(level) {
            try {
                const rewardTier = Math.floor(level / 5);
                const rewardAmount = 500000 * Math.pow(2, rewardTier - 1);
                
                // Add money to user account
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                const currentBalance = userData.balance || 0;
                
                await db.collection('users').doc(currentUser.uid).update({
                    balance: currentBalance + rewardAmount
                });
                
                // Create transaction record
                const transaction = {
                    id: 'tree_reward_' + Date.now(),
                    userId: currentUser.uid,
                    type: 'tree_reward',
                    amount: rewardAmount,
                    status: 'completed',
                    description: `Ph·∫ßn th∆∞·ªüng c·∫•p ${level} - Game tr·ªìng c√¢y`,
                    createdAt: new Date()
                };
                
                addTransaction(transaction);
                
                showNotification(`üéÅ Nh·∫≠n th∆∞·ªüng ${new Intl.NumberFormat('vi-VN').format(rewardAmount)} VNƒê cho c·∫•p ${level}!`, 'success');
                addAchievement(`Nh·∫≠n th∆∞·ªüng ${new Intl.NumberFormat('vi-VN').format(rewardAmount)} VNƒê (C·∫•p ${level}) üéÅ`);
                
            } catch (error) {
                console.error('Error giving reward:', error);
                showNotification('L·ªói trao th∆∞·ªüng: ' + error.message, 'error');
            }
        }

        // Add achievement to history
        function addAchievement(text) {
            const achievement = {
                text: text,
                timestamp: new Date()
            };
            
            treeGame.achievements.unshift(achievement); // Add to beginning
            
            // Keep only last 20 achievements
            if (treeGame.achievements.length > 20) {
                treeGame.achievements = treeGame.achievements.slice(0, 20);
            }
            
            updateAchievementDisplay();
            saveTreeGameData();
        }

        // Update achievement display
        function updateAchievementDisplay() {
            const achievementHistory = document.getElementById('achievementHistory');
            if (!achievementHistory) return;
            
            if (treeGame.achievements.length === 0) {
                achievementHistory.innerHTML = '<p class="text-gray-400 text-center py-4">Ch∆∞a c√≥ th√†nh t√≠ch n√†o</p>';
                return;
            }
            
            achievementHistory.innerHTML = treeGame.achievements.map(achievement => {
                const timeStr = new Date(achievement.timestamp).toLocaleString('vi-VN');
                return `
                    <div class="bg-gray-800 border border-gray-600 rounded-lg p-3 flex justify-between items-center">
                        <span class="text-white text-sm">${achievement.text}</span>
                        <span class="text-gray-400 text-xs">${timeStr}</span>
                    </div>
                `;
            }).join('');
        }

        // Voucher system functions
        function saveUserVouchers() {
            if (!currentUser) return;
            
            const storageKey = `vouchers_${currentUser.uid}`;
            try {
                localStorage.setItem(storageKey, JSON.stringify(userVouchers));
                console.log('Saved vouchers to storage');
            } catch (error) {
                console.error('Error saving vouchers to storage:', error);
            }
        }

        function loadUserVouchers() {
            if (!currentUser) return;
            
            const storageKey = `vouchers_${currentUser.uid}`;
            const stored = localStorage.getItem(storageKey);
            
            if (stored) {
                try {
                    userVouchers = JSON.parse(stored);
                    console.log('Loaded vouchers from storage:', userVouchers);
                } catch (error) {
                    console.error('Error parsing stored vouchers:', error);
                    userVouchers = [];
                }
            } else {
                userVouchers = [];
            }
        }

        // Daily missions functions
        function checkDailyReset() {
            const today = new Date().toDateString();
            const lastReset = treeGame.dailyMissions.lastReset;
            
            if (lastReset !== today) {
                // Reset daily missions
                treeGame.dailyMissions = {
                    lastReset: today,
                    loginReward: false,
                    purchaseCount: 0,
                    topupAmount: 0
                };
                
                console.log('Daily missions reset for:', today);
                saveTreeGameData();
            }
        }

        function updateDailyMissions() {
            const missionsContainer = document.getElementById('dailyMissions');
            if (!missionsContainer) return;

            const missions = [
                {
                    id: 'login',
                    title: 'üéØ ƒêƒÉng nh·∫≠p h√†ng ng√†y',
                    description: 'Nh·∫≠n 3 l∆∞·ª£t b√≥n ph√¢n + 1 l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc',
                    completed: treeGame.dailyMissions.loginReward,
                    reward: '3 üå± + 1 üíß'
                },
                {
                    id: 'purchase',
                    title: 'üõí Mua 3+ s·∫£n ph·∫©m trong ng√†y',
                    description: `ƒê√£ mua: ${treeGame.dailyMissions.purchaseCount}/3`,
                    completed: treeGame.dailyMissions.purchaseCount >= 3,
                    reward: '6 üíß'
                },
                {
                    id: 'topup',
                    title: 'üí∞ N·∫°p ti·ªÅn tr√™n 100K trong ng√†y',
                    description: `ƒê√£ n·∫°p: ${new Intl.NumberFormat('vi-VN').format(treeGame.dailyMissions.topupAmount)} VNƒê`,
                    completed: treeGame.dailyMissions.topupAmount >= 100000,
                    reward: '10 üíß'
                }
            ];

            missionsContainer.innerHTML = missions.map(mission => `
                <div class="bg-gray-800 border border-gray-600 rounded-lg p-3 flex justify-between items-center">
                    <div class="flex-1">
                        <h5 class="text-white font-semibold text-sm">${mission.title}</h5>
                        <p class="text-gray-400 text-xs">${mission.description}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-purple-300 text-xs font-bold">${mission.reward}</p>
                        ${mission.completed ? 
                            '<span class="text-green-400 text-xs">‚úÖ Ho√†n th√†nh</span>' : 
                            mission.id === 'login' && !mission.completed ? 
                                `<button onclick="claimLoginReward()" class="bg-purple-600 text-white px-2 py-1 rounded text-xs hover:bg-purple-700 transition-colors">Nh·∫≠n</button>` :
                                '<span class="text-gray-500 text-xs">Ch∆∞a ho√†n th√†nh</span>'
                        }
                    </div>
                </div>
            `).join('');
        }

        function claimLoginReward() {
            if (treeGame.dailyMissions.loginReward) {
                showNotification('ƒê√£ nh·∫≠n th∆∞·ªüng ƒëƒÉng nh·∫≠p h√¥m nay!', 'error');
                return;
            }

            treeGame.dailyMissions.loginReward = true;
            treeGame.freeFertilizer += 3;
            treeGame.freeWater += 1;
            
            saveTreeGameData();
            updateTreeDisplay();
            updateDailyMissions();
            
            showNotification('üéâ Nh·∫≠n th∆∞·ªüng ƒëƒÉng nh·∫≠p: +3 l∆∞·ª£t b√≥n ph√¢n, +1 l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc!', 'success');
            addAchievement('Nh·∫≠n th∆∞·ªüng ƒëƒÉng nh·∫≠p h√†ng ng√†y üéØ');
        }

        function checkPurchaseMission() {
            treeGame.dailyMissions.purchaseCount++;
            
            if (treeGame.dailyMissions.purchaseCount >= 3 && treeGame.dailyMissions.purchaseCount === 3) {
                // First time completing purchase mission today
                treeGame.freeWater += 6;
                showNotification('üéâ Ho√†n th√†nh nhi·ªám v·ª• mua h√†ng: +6 l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc!', 'success');
                addAchievement('Ho√†n th√†nh nhi·ªám v·ª• mua 3+ s·∫£n ph·∫©m üõí');
            }
            
            saveTreeGameData();
            updateDailyMissions();
            updateTreeDisplay();
        }

        function checkTopupMission(amount) {
            const oldAmount = treeGame.dailyMissions.topupAmount;
            treeGame.dailyMissions.topupAmount += amount;
            
            if (oldAmount < 100000 && treeGame.dailyMissions.topupAmount >= 100000) {
                // First time completing topup mission today
                treeGame.freeWater += 10;
                showNotification('üéâ Ho√†n th√†nh nhi·ªám v·ª• n·∫°p ti·ªÅn: +10 l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc!', 'success');
                addAchievement('Ho√†n th√†nh nhi·ªám v·ª• n·∫°p ti·ªÅn 100K+ üí∞');
            }
            
            saveTreeGameData();
            updateDailyMissions();
            updateTreeDisplay();
        }

        // Free care functions
        function useFreeWater() {
            if (treeGame.freeWater <= 0) {
                showNotification('Kh√¥ng c√≤n l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc mi·ªÖn ph√≠!', 'error');
                return;
            }

            treeGame.freeWater--;
            treeGame.currentExp += 100;
            treeGame.totalExp += 100;

            saveTreeGameData();
            updateTreeDisplay();

            showNotification('ƒê√£ t∆∞·ªõi n∆∞·ªõc mi·ªÖn ph√≠! +100 EXP', 'success');
            addAchievement('T∆∞·ªõi n∆∞·ªõc mi·ªÖn ph√≠ (+100 EXP) üíß');
        }

        function useFreeFertilizer() {
            if (treeGame.freeFertilizer <= 0) {
                showNotification('Kh√¥ng c√≤n l∆∞·ª£t b√≥n ph√¢n mi·ªÖn ph√≠!', 'error');
                return;
            }

            treeGame.freeFertilizer--;
            treeGame.currentExp += 1000;
            treeGame.totalExp += 1000;

            saveTreeGameData();
            updateTreeDisplay();

            showNotification('ƒê√£ b√≥n ph√¢n mi·ªÖn ph√≠! +1000 EXP', 'success');
            addAchievement('B√≥n ph√¢n mi·ªÖn ph√≠ (+1000 EXP) üå±');
        }

        // Initialize tree game on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Load tree game data when user logs in
            if (currentUser) {
                loadTreeGameData();
            }
        });

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98a6f71376f70540',t:'MTc1OTc3MjY1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
